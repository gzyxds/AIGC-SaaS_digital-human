import{f as oe,r as c,y as te,j as se,o as f,A as L,w as x,k as s,l as M,a4 as ne,a as t,b as r,n as le,c as k,F as P,m as R,v as T,B as ae,t as g,a5 as H,d as E,U as q,D as re,q as ie,x as de,E as ce,e as ue,a9 as me}from"./iBiA3qHo.js";import{d as fe,_ as ve}from"./B8-tLZve.js";import{h as pe}from"./BLDARQqd.js";import{d as _e}from"./DxM3l_Qq.js";import{b as xe}from"./75-SRlBf.js";import{_ as ge}from"./DxqbCNiF.js";import{_ as be}from"./DQcmSzy7.js";import{u as F}from"./BK3-fmoW.js";import{f as he}from"./DH1JQC-z.js";const we={class:"p-4 md:p-6"},ye={class:"mb-4 flex items-center justify-between"},ke={class:"flex max-h-[calc(90vh-10rem)] flex-col gap-4 md:max-h-[calc(80vh-8rem-28px)] md:flex-row"},Ce={class:"flex min-h-60 flex-col gap-2 overflow-y-auto md:max-h-full md:flex-1 md:pr-2"},Ve=["id","onClick"],$e={class:"group relative cursor-pointer"},ze={class:"absolute inset-0 z-10 flex size-full flex-col justify-end overflow-hidden rounded-lg md:rounded-xl"},Ae={class:"flex justify-between overflow-hidden rounded-b-lg bg-foreground/30 p-2 text-background backdrop-blur md:rounded-b-xl"},Ue={class:"text-sm"},Ie={style:{"text-shadow":"0 0 1px rgba(0, 0, 0, 0.1)"},class:"rounded bg-white/30 p-[1px_4px] text-[10px] backdrop-blur center"},Me={class:"flex flex-1 flex-col overflow-y-auto"},Ee=["onClick"],je=["src"],Be={class:"flex flex-col gap-2"},De={class:"font-medium"},Ne={class:"line-clamp-2 text-sm text-foreground/60"},Se=["onClick"],Le={class:"flex flex-col items-center justify-between gap-4 pt-4"},Pe={class:"flex w-full flex-col items-center justify-between gap-4 md:flex-row"},Re={class:"flex items-center gap-4"},Te={class:"center"},He={class:"w-full center md:end"},qe={class:"text-xs text-foreground/50"},eo=oe({__name:"batch-generator",emits:["stepChange","close"],setup(Fe,{expose:G,emit:O}){const b=c(!1),v=c(!1),p=c([]),j=te(),_=c(1),a=c(0),h=c(!1),C=c([]),U=c(0),B=O,u=c([]),D=()=>{const n=C.value.find(e=>e.mode===_.value);if(n){let e=0;u.value.forEach(l=>{var m;const i=Math.ceil(Number(((m=l.voice)==null?void 0:m.duration)||0)/60);e+=n.video_power*i}),U.value=e}},J=(n,e,l)=>{a.value=e,u.value[a.value].video=n,l.currentTarget.scrollIntoView({behavior:"smooth",block:"start"})},K=n=>{u.value[a.value].voice=n,a.value<p.value.length-1&&setTimeout(()=>{var e;a.value+=1,(e=document.getElementById(`video-item-${a.value}`))==null||e.scrollIntoView({behavior:"smooth",block:"start"})},300),D()},{getList:Q,refresh:W,state:X,list:N}=pe(),Y=async n=>{b.value=!0,C.value=await xe(),_.value=C.value[0].mode,a.value=0,h.value=!1,U.value=0,W({mode:"load"}),p.value=n,u.value=Array.from({length:n.length},()=>({video:null,voice:null})),u.value.forEach((e,l)=>{e.video=n[l]})},Z=async()=>{var e,l,i,m,V,$,z;const n=u.value.findIndex(w=>!w.voice);if(n!==-1){q().error(`第 ${n+1} 个视频未配置声音`);return}v.value=!0;try{for(const[w,d]of u.value.entries()){const o={cover:(e=d.video)==null?void 0:e.cover,title:`${((l=d.video)==null?void 0:l.name)||((i=d.video)==null?void 0:i.id)}-${((m=d.voice)==null?void 0:m.title)||((V=d.voice)==null?void 0:V.id)}-${he(new Date,"yyyy-MM-dd HH:mm")}`,video_id:($=d.video)==null?void 0:$.id,voice_id:(z=d.voice)==null?void 0:z.file_id,mode:_.value};await _e(o)}await F(async()=>{v.value=!1,I(),re("/avatar/works")})}catch{F(async()=>{q().error("部分合成失败，请前往【我的作品】查看合成结果"),v.value=!1})}},I=()=>{a.value=0,p.value=[],N.value=[],b.value=!1,B("close")};return G({open:Y}),(n,e)=>{const l=ie,i=de,m=ve,V=ce,$=ue,z=me,w=ne,d=se("load");return f(),L(w,{modelValue:s(b),"onUpdate:modelValue":e[3]||(e[3]=o=>M(b)?b.value=o:null),ui:{width:"sm:max-w-3xl",container:"items-center",base:"overflow-hidden"},onClose:e[4]||(e[4]=o=>B("close"))},{default:x(()=>[t("div",we,[t("div",ye,[e[5]||(e[5]=t("h1",{class:"text-xl font-medium"},"批量合成",-1)),r(l,{icon:"tabler:x",ui:{icon:{size:{sm:"h-5 w-5"}},square:{sm:"p-1"}},size:"sm",variant:"ghost",onClick:e[0]||(e[0]=o=>I())})]),le((f(),k("div",ke,[t("div",Ce,[(f(!0),k(P,null,R(s(p),(o,y)=>(f(),k("div",{id:`video-item-${y}`,key:o.id,class:"rounded-lg bg-background-soft transition-colors hover:bg-foreground/5 md:rounded-xl",onClick:A=>J(o,y,A)},[t("div",$e,[t("div",{class:T(["absolute inset-0 z-50 size-full cursor-pointer rounded-lg border-2 border-transparent p-2 transition-[border] md:rounded-xl",{"!border-primary bg-foreground/20":s(p)[s(a)].id===o.id}])},[s(p)[s(a)].id===o.id?(f(),L(i,{key:0,name:"tabler:square-rounded-check-filled",class:"text-primary",size:"28"})):ae("",!0)],2),r(m,{class:"rounded-lg md:rounded-xl",src:o.cover},null,8,["src"]),t("div",ze,[t("div",Ae,[t("h1",Ue,g(o.name||"暂无标题"),1),t("span",Ie,g(("formatSecond"in n?n.formatSecond:s(H))(o.duration)),1)])])])],8,Ve))),128))]),t("div",Me,[r(be,{class:"flex h-full flex-1 flex-col gap-2 overflow-y-auto",state:s(X),"load-more":()=>s(Q)({mode:"load"})},{default:x(()=>[(f(!0),k(P,null,R(s(N),o=>{var y,A;return f(),k("div",{key:o.id,class:T(["flex cursor-pointer rounded-lg border border-transparent bg-background-soft transition-[border]",{"!border-primary bg-primary/20":o.id===((A=(y=s(u)[s(a)])==null?void 0:y.voice)==null?void 0:A.id)}])},[t("div",{class:"flex flex-1 items-center gap-2 p-2",onClick:ee=>K(o)},[t("img",{src:o.cover||s(fe),class:"relative h-14 w-14 rounded-xl"},null,8,je),t("div",Be,[t("h2",De,g(o.title||"--"),1),t("p",Ne,g(o.content),1)])],8,Ee),t("div",{class:"ml-auto flex flex-col items-center justify-center p-2",onClick:ee=>{var S;return(S=s(j))==null?void 0:S.open({cover:o.cover,url:o.voice_url})}},[t("span",null,g(("formatSecond"in n?n.formatSecond:s(H))(o.duration)),1),r(i,{name:"tabler:player-play-filled"})],8,Se)],2)}),128))]),_:1},8,["state","load-more"]),e[6]||(e[6]=t("p",{class:"px-4 py-2 text-center text-xs text-foreground/60 md:text-end"}," Tips：选择音频之后会自动跳到下一个视频 ",-1))])])),[[d,s(v)]]),t("div",Le,[t("div",Pe,[r(V,{modelValue:s(_),"onUpdate:modelValue":e[1]||(e[1]=o=>M(_)?_.value=o:null),options:s(C),placeholder:"通道选择","value-attribute":"mode","option-attribute":"video_mode_title",onChange:D},null,8,["modelValue","options"]),t("div",Re,[r(l,{ui:{rounded:"rounded-full",padding:{md:"px-6"}},size:"md",color:"white",disabled:s(v),onClick:I},{default:x(()=>e[7]||(e[7]=[E("取消合成")])),_:1},8,["disabled"]),r(l,{ui:{rounded:"rounded-full",padding:{md:"px-6"}},size:"md",disabled:!s(h),loading:s(v),onClick:Z},{default:x(()=>[e[8]||(e[8]=t("span",null,"开始合成",-1)),t("span",Te,[E(" 消耗"+g(s(U)),1),r(i,{name:"heroicons:bolt-solid"})])]),_:1},8,["disabled","loading"])])]),t("div",He,[r(z,{modelValue:s(h),"onUpdate:modelValue":e[2]||(e[2]=o=>M(h)?h.value=o:null),name:"notifications",label:"Notifications",ui:{inner:"ms-2",base:"size-3.5",wrapper:"items-center"}},{label:x(()=>[t("p",qe,[e[10]||(e[10]=t("span",null,"请先阅读并同意",-1)),r($,{target:"_blank",class:"mx-[1px] font-medium text-primary",to:"/agreement?type=agreement&item=use"},{default:x(()=>e[9]||(e[9]=[E(" 《使用协议》 ")])),_:1})])]),_:1},8,["modelValue"])])])]),r(ge,{ref_key:"AudioModalRef",ref:j},null,512)]),_:1},8,["modelValue"])}}});export{eo as _};
