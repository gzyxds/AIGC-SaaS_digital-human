import{f as E,W as L,r,bK as i,bL as A,am as M,o as a,A as w,w as C,k as s,l as O,a6 as Q,af as z,a as _,c as p,b as P,d as W,B as v,t as q,bM as G,q as K,s as R,bN as $}from"./iBiA3qHo.js";const j={class:"flex flex-col gap-4 pt-4 center"},F={key:0,class:"relative overflow-hidden rounded-lg border border-border/50"},H=["src"],I={key:0,class:"absolute inset-0 bg-black/20 text-white backdrop-blur center"},J={key:1,class:"absolute inset-0 bg-black/20 text-sm text-white backdrop-blur center"},X={key:2,class:"absolute inset-0 bg-black/20 text-sm text-white backdrop-blur center"},ee=E({__name:"bindWechat",emits:["refresh"],setup(Y,{expose:y,emit:N}){const h=N,T=L(),n=r(!1),o=r(),c=r(!0),l=r(i.NOSCAN),f=r(null),b=async()=>{o.value=await G("bind"),c.value=!0,g(()=>x()),k(()=>B())},U=async()=>{l.value=i.NOSCAN,c.value=!1,n.value=!0,await b(),x()},x=()=>{var e;f.value=setTimeout(()=>{c.value=!1},Q.times(((e=o.value)==null?void 0:e.expire_seconds)||120,1e3))},g=e=>{f.value!==null&&clearTimeout(f.value),e==null||e()},{start:B,clear:k}=A(async e=>{var t,u;if((t=o.value)!=null&&t.key){const d=await $({key:(u=o.value)==null?void 0:u.key,channel:"bind"});l.value=d.status,d.status===i.SUCCESS&&(e(),n.value=!1,T.getUser(),h("refresh"))}}),V=()=>{S(),o.value=void 0},S=()=>{g(),k()};return M(()=>{S()}),y({open:U}),(e,t)=>{const u=K,d=R,D=z;return a(),w(D,{modelValue:s(n),"onUpdate:modelValue":t[0]||(t[0]=m=>O(n)?n.value=m:null),title:"绑定微信",onClose:V},{default:C(()=>{var m;return[_("div",j,[s(o)?(a(),p("div",F,[_("img",{class:"size-48",src:(m=s(o))==null?void 0:m.url,alt:"微信登录二维码"},null,8,H),s(c)?v("",!0):(a(),p("div",I,[P(u,{icon:"tabler:reload",onClick:b},{default:C(()=>t[1]||(t[1]=[W("刷新")])),_:1})])),s(l)===s(i).SCANNED?(a(),p("div",J," 已扫码 ")):v("",!0),s(l)===s(i).SUCCESS?(a(),p("div",X," 绑定成功 ")):v("",!0)])):(a(),w(d,{key:1,class:"size-48 rounded-lg"})),_("p",null,q({1:"使用微信扫码绑定微信",2:"已扫码",4:"登录成功"}[s(l)]),1),t[2]||(t[2]=_("p",{class:"text-sm text-foreground/60"},"扫码绑定后可以使用微信扫码登录",-1))])]}),_:1},8,["modelValue"])}}});export{ee as _};
