import{L as ae,cx as M,az as H,ay as J,f as re,u as ne,W as le,ao as ie,r as f,h as de,cy as ce,am as pe,j as q,o as n,A as v,w as c,a as e,b as d,k as s,n as E,t as r,d as h,c as m,B as w,v as I,m as ue,F as me,cz as _e,cA as fe,l as xe,bW as ge,bt as be,x as ye,e as ve,q as he,af as we,bL as ke,cB as Pe,U as Ce}from"./iBiA3qHo.js";import{_ as Se}from"./Cp6gw0qI.js";import{_ as $e}from"./UoGWXlX4.js";import{_ as Be}from"./DluhCU7w.js";import{_ as Ue}from"./jEpb_vT2.js";import{_ as Ne}from"./BRU1X883.js";import{i as Ve}from"./wAdwjX8V.js";import{c as Le}from"./75-SRlBf.js";import{_ as ze,F as Ae}from"./Cvmx41xT.js";import"./DPda_AxG.js";function De(i){return i.flatMap(x=>{const p=M(x);return Array.isArray(p)?p.map(a=>M(a)):[p]})}function Fe(...i){return ae(()=>De(i).reduce((x,p)=>x+=p,0))}const je=()=>H("/pay/powerPayWay"),Re=i=>J("/recharge/recharge",i),Te=i=>J("/pay/prepay",i),We=i=>H("/pay/payStatus",i),Ge={class:"relative md:flex md:justify-center md:p-6"},Me={class:"flex w-full max-w-prose flex-col gap-4 pb-32 md:pb-28"},qe={class:"flex flex-col gap-1"},Ee={class:"font-bold text-foreground/70"},Ie={class:"flex items-center text-2xl text-primary"},He=["src"],Je={key:0,class:"text-sm text-green-500"},Ke={class:"text-xs text-foreground/40 line-through"},Oe={class:"text-amber-400"},Qe={class:"text-xs text-foreground/70"},Xe={class:"text-xs text-foreground/80"},Ye={key:0,class:"absolute -bottom-5 -right-5 flex h-10 w-10 rotate-45 items-center justify-start bg-primary"},Ze={key:1,class:"w-full py-20 center"},et={key:0,class:"flex-col text-primary center"},tt={class:"flex gap-4"},st=["src","alt"],ot={class:"text-sm"},at={key:0,class:"absolute -bottom-5 -right-5 flex h-10 w-10 rotate-45 items-center justify-start bg-primary"},rt={class:"text-md mb-4 font-medium"},nt={class:"whitespace-pre-wrap text-sm leading-6"},lt={class:"mx-4 flex max-w-prose flex-1 items-center justify-between rounded-xl bg-background p-4 dark:md:bg-background-soft",style:{"box-shadow":"0 -2px 8px rgba(0, 0, 0, 0.05)"}},it={class:"mr-2 text-2xl font-bold text-red-500"},dt={class:"inline-flex items-center text-xs"},ct={class:"mx-1 text-sm font-bold text-primary"},pt={class:"p-2"},ut={class:"text-primary"},mt={key:0},_t={class:"text-green-500"},ft={class:"text-xs"},xt={class:"flex-col center"},gt={class:"mt-2 flex items-center text-xl font-bold text-red-500"},Bt=re({__name:"recharge",setup(i){ne({title:"充值中心"});const x=le(),p=ie(),a=f(null),P=f(0),V=f([]),C=f(""),g=f(!1),L=f("");let S;const{getList:K,list:k,state:z}=Le();de(async()=>{V.value=await je(),await K(),k.value.length>0&&(a.value=k.value[0]),L.value=(await ce("currency")).content});const O=l=>{a.value=l},Q=ge(async()=>{var y;const l=await Re({package:(y=a.value)==null?void 0:y.id}),t=await Te({from:"recharge",order_id:l.order_id,pay_way:"2"});C.value=t.config,g.value=!0;const{start:$,clear:b}=ke(async B=>{We({from:"recharge",order_id:l.order_id}).then(U=>{U.pay_status===Pe.PAID&&(B(),g.value=!1,Ce().success("支付成功"),x.getUser())})});S=b,$()});return pe(()=>{S&&S()}),(l,t)=>{const $=be,b=ye,y=Se,B=$e,U=Be,X=Ue,Y=ve,Z=he,ee=we,te=Ne,se=q("load"),oe=q("dompurify-html");return n(),v(te,{scroll:!0,breadcrumb:"充值中心",prose:"",padding:"p-4 md:p-0",rounded:!1,background:!0},{default:c(()=>{var A,D,F,j,R,T,W;return[e("div",Ge,[e("div",Me,[e("div",null,[d(ze)]),e("div",null,[t[2]||(t[2]=e("div",{class:"text-md mb-4 font-medium"},"套餐列表",-1)),s(k).length>0?E((n(),v(B,{key:0,class:"min-h-48",items:s(k),arrows:"",ui:{wrapper:"group",container:"gap-6",default:{prevButton:{class:"!opacity-0 group-hover:!opacity-100 pointer-events-none group-hover:pointer-events-auto transition-opacity !bg-black/50 dark:!bg-white/20"},nextButton:{class:"!opacity-0 group-hover:!opacity-100 pointer-events-none group-hover:pointer-events-auto transition-opacity !bg-black/50 dark:!bg-white/50"}}}},{default:c(({item:o,index:u})=>{var _,G;return[d(y,{class:I(["relative box-border min-w-48 cursor-pointer overflow-hidden",((_=s(a))==null?void 0:_.id)===o.id?"md:bg-primary/10":""]),border:((G=s(a))==null?void 0:G.id)===o.id?"border-[1.5px] border-primary":"border-[1.5px] border-border/30",onClick:N=>O(o)},{default:c(()=>{var N;return[e("div",qe,[e("h1",Ee,r(o.title||`套餐${u+1}`),1),e("p",Ie,[e("img",{class:"h-5 w-5",src:s(Ae),alt:"电量图标"},null,8,He),h(" "+r(o.power),1)]),o.gift===1?(n(),m("p",Je," 赠："+r(o.gift_power),1)):w("",!0),e("p",Ke," 原价：¥"+r(o.original_cost||"--"),1),e("p",Oe,"¥"+r(o.cost),1),d($,{class:"my-2"}),e("p",Qe," 有效期："+r(o.expire_time||"永久有效"),1),e("p",Xe,"备注："+r(o.note),1)]),((N=s(a))==null?void 0:N.id)===o.id?(n(),m("div",Ye,[d(b,{name:"tabler:check",class:"-rotate-45 text-white"})])):w("",!0)]}),_:2},1032,["class","border","onClick"])]}),_:1},8,["items"])),[[se,s(z).pedding]]):(n(),m("div",Ze,[s(z).pedding?(n(),m("div",et,[d(b,{size:"24",name:"tabler:loader-2",class:"animate-spin"}),t[1]||(t[1]=e("span",{class:"text-sm"},"正在加载",-1))])):(n(),v(U,{key:1,type:"empty",text:"暂无套餐"}))]))]),e("div",null,[t[3]||(t[3]=e("div",{class:"text-md mb-4 font-medium"},"支付方式",-1)),e("div",tt,[(n(!0),m(me,null,ue(s(V),(o,u)=>(n(),v(y,{key:o.id,padding:"px-6 py-4",class:"relative flex cursor-pointer items-center gap-2 overflow-hidden",border:s(P)===u?"border-[1.5px] border-primary":"border-[1.5px] border-border/30",onClick:_=>P.value=u},{default:c(()=>[e("img",{src:o.icon,alt:o.name,class:"size-10"},null,8,st),e("span",ot,r(o.name),1),s(P)===u?(n(),m("div",at,[d(b,{name:"tabler:check",class:"-rotate-45 text-white"})])):w("",!0)]),_:2},1032,["border","onClick"]))),128))])]),e("div",null,[e("div",rt,r((A=s(p).siteConfig)==null?void 0:A.unit.power)+"说明 ",1),e("div",nt,[E(e("div",null,null,512),[[oe,s(L)]])])]),e("div",{class:I(["fixed bottom-4 left-0 flex w-full pr-2 center md:bottom-6 md:pl-64 lg:pl-72",("inTabbar"in l?l.inTabbar:s(_e))((l._.provides[fe]||l.$route).path)?"bottom-16":"bottom-0"])},[e("div",lt,[e("div",null,[e("div",null,[t[8]||(t[8]=e("span",{class:"text-sm font-bold"},"需支付：",-1)),e("span",it," ¥"+r(((D=s(a))==null?void 0:D.cost)||"--"),1),e("span",dt,[t[7]||(t[7]=e("span",null,"总得 ",-1)),e("span",ct,r(((F=s(a))==null?void 0:F.gift)==1?("useSum"in l?l.useSum:s(Fe))(Number((j=s(a))==null?void 0:j.power),Number((R=s(a))==null?void 0:R.gift_power)).value:((T=s(a))==null?void 0:T.power)||"--"),1),e("span",null,r((W=s(p).siteConfig)==null?void 0:W.unit.power),1),d(X,{mode:"click"},{panel:c(()=>{var o,u,_;return[e("div",pt,[e("p",null,[t[4]||(t[4]=e("span",null," 充值数量：",-1)),e("span",ut,r(Number((o=s(a))==null?void 0:o.power)),1)]),((u=s(a))==null?void 0:u.gift)==1?(n(),m("p",mt,[t[5]||(t[5]=e("span",null," 加赠数量：",-1)),e("span",_t,r(Number((_=s(a))==null?void 0:_.gift_power)),1)])):w("",!0)])]}),default:c(()=>[t[6]||(t[6]=e("span",{class:"ml-1 text-xs text-foreground/50"},"明细",-1))]),_:1})])]),e("span",ft,[t[10]||(t[10]=h(" 支付即代表你同意")),d(Y,{class:"text-primary",to:"/agreement?type=agreement&item=recharge",target:"_blank"},{default:c(()=>t[9]||(t[9]=[h(" 《充值协议》 ")])),_:1})])]),d(Z,{size:"lg",disabled:s(a)===null,onClick:s(Q)},{default:c(()=>t[11]||(t[11]=[h("立即支付")])),_:1},8,["disabled","onClick"])])],2)]),d(ee,{modelValue:s(g),"onUpdate:modelValue":t[0]||(t[0]=o=>xe(g)?g.value=o:null),title:"微信支付"},{default:c(()=>{var o;return[e("div",xt,[s(C)?(n(),v(s(Ve),{key:0,class:"size-52 rounded-lg",value:s(C),color:{dark:"#000000",light:"#ffffff"},type:"image/png"},null,8,["value"])):w("",!0),e("p",gt,[t[12]||(t[12]=e("span",{class:"text-base text-foreground"},"合计：",-1)),h("¥"+r(((o=s(a))==null?void 0:o.cost)||"--"),1)]),t[13]||(t[13]=e("p",{class:"mt-2"},"请使用微信扫码支付",-1)),t[14]||(t[14]=e("p",{class:"mt-4 text-xs text-foreground/60"}," 如遇问题无法解决时，请联系站点管理员 ",-1))])]}),_:1},8,["modelValue"])])]}),_:1})}}});export{Bt as default};
