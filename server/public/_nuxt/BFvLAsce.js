import{G as me,ag as _e,H as G,_ as pe,f as K,J as fe,K as te,ah as ve,r as g,ai as ge,h as H,ab as xe,p as X,L as ye,M as he,N as be,o as k,c as T,a as o,P as we,O as ke,v as ae,aj as Ce,y as D,A as j,w as u,b as r,k as s,l as J,ak as $e,d as N,t as C,m as oe,F as se,al as Ve,q as ne,af as ze,X as E,Y as $,T as Se,z as Ue,g as qe,C as Be,am as Ie,U as Ae,an as Ne,a3 as Re,ao as Le,I as Me,x as Te,a8 as je,a7 as Oe,e as Fe,a9 as Ee}from"./iBiA3qHo.js";import{a as De}from"./DIFg_cFK.js";import{_ as Pe}from"./Cb4KlQxU.js";import{e as Ge,a as He,f as Je}from"./BLDARQqd.js";import{a as Ke}from"./75-SRlBf.js";import{s as F}from"./BoJhwiBp.js";import{a as Xe,_ as Ye}from"./CTy8_DAc.js";import{_ as Qe}from"./C2fI3Sz2.js";import{_ as We}from"./M2xpECKh.js";import{_ as Ze}from"./D81t8MNF.js";import{_ as et}from"./DxqbCNiF.js";import{_ as tt}from"./DU3fwEm4.js";import{u as ot}from"./BCw_9tXi.js";import{u as st}from"./BK3-fmoW.js";import{C as at}from"./BviGXemD.js";const A=me(G.ui.strategy,G.ui.textarea,_e),nt=K({inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rows:{type:Number,default:3},maxrows:{type:Number,default:0},autoresize:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},resize:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(t){return Object.keys(A.size).includes(t)}},color:{type:String,default:()=>A.default.color,validator(t){return[...G.ui.colors,...Object.keys(A.color)].includes(t)}},variant:{type:String,default:()=>A.default.variant,validator(t){return[...Object.keys(A.variant),...Object.values(A.color).flatMap(m=>Object.keys(m))].includes(t)}},textareaClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(t,{emit:m}){const{ui:x,attrs:R}=fe("textarea",te(t,"ui"),A,te(t,"class")),{emitFormBlur:U,emitFormInput:h,inputId:c,color:w,size:V,name:O}=ve(t,A),b=g(ge({},t.modelModifiers,{trim:!1,lazy:!1,number:!1,nullify:!1})),d=g(null),q=()=>{var a;t.autofocus&&((a=d.value)==null||a.focus())},n=()=>{if(t.autoresize){if(!d.value)return;d.value.rows=t.rows;const a=d.value.style.overflow;d.value.style.overflow="hidden";const v=window.getComputedStyle(d.value),S=Number.parseInt(v.paddingTop),M=Number.parseInt(v.paddingBottom),i=S+M,e=Number.parseInt(v.lineHeight),{scrollHeight:_}=d.value,y=(_-i)/e;y>t.rows&&(d.value.rows=t.maxrows?Math.min(y,t.maxrows):y),d.value.style.overflow=a}},B=a=>{b.value.trim&&(a=a.trim()),b.value.number&&(a=Ce(a)),b.value.nullify&&(a||(a=null)),m("update:modelValue",a),h()},p=a=>{n(),b.value.lazy||B(a.target.value)},l=a=>{const v=a.target.value;m("change",v),b.value.lazy&&B(v),b.value.trim&&(a.target.value=v.trim())},f=a=>{m("blur",a),U()};H(()=>{setTimeout(()=>{q()},t.autofocusDelay)}),xe(()=>t.modelValue,()=>{X(n)}),H(()=>{setTimeout(()=>{q(),n()},100)});const I=ye(()=>{var v,S;const a=((S=(v=x.value.color)==null?void 0:v[w.value])==null?void 0:S[t.variant])||x.value.variant[t.variant];return he(be(x.value.base,x.value.form,x.value.rounded,x.value.placeholder,x.value.size[V.value],t.padded?x.value.padding[V.value]:"p-0",a==null?void 0:a.replaceAll("{color}",w.value),!t.resize&&"resize-none"),t.textareaClass)});return{ui:x,attrs:R,name:O,inputId:c,textarea:d,textareaClass:I,onInput:p,onChange:l,onBlur:f}}}),lt=["id","value","name","rows","required","disabled","placeholder"];function rt(t,m,x,R,U,h){return k(),T("div",{class:ae(t.ui.wrapper)},[o("textarea",we({id:t.inputId,ref:"textarea",value:t.modelValue,name:t.name,rows:t.rows,required:t.required,disabled:t.disabled,placeholder:t.placeholder,class:t.textareaClass},t.attrs,{onInput:m[0]||(m[0]=(...c)=>t.onInput&&t.onInput(...c)),onBlur:m[1]||(m[1]=(...c)=>t.onBlur&&t.onBlur(...c)),onChange:m[2]||(m[2]=(...c)=>t.onChange&&t.onChange(...c))}),null,16,lt),ke(t.$slots,"default")],2)}const it=pe(nt,[["render",rt]]),ut={class:"flex h-[80vh] flex-col"},dt={class:"flex items-center justify-between"},ct={class:"mb-2 flex flex-1 md:mb-4"},mt={class:"flex-1 overflow-hidden"},_t={key:0,class:"flex h-full flex-col"},pt={class:"group relative flex cursor-pointer gap-4 rounded-lg bg-background-soft p-4"},ft={class:"absolute bottom-0 left-0 z-10 h-0 w-full cursor-pointer overflow-hidden rounded-lg bg-foreground/20 backdrop-blur-lg transition-[height] group-hover:h-10"},vt={class:"flex w-full items-center justify-end px-2 py-2"},gt={class:"audio-container relative h-14 w-14 flex-shrink-0"},xt=["src"],yt={class:""},ht={class:"font-medium"},bt={class:"mt-1 line-clamp-2 text-sm text-foreground/60"},wt={class:"mt-1 line-clamp-2 text-xs text-foreground/60"},kt={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3"},Ct={class:"absolute bottom-0 left-0 z-10 h-0 w-full cursor-pointer overflow-hidden rounded-lg bg-foreground/20 backdrop-blur-lg transition-[height] group-hover:h-10"},$t={class:"flex w-full items-center justify-end px-2 py-2"},Vt={class:"audio-container relative flex flex-shrink-0 items-center gap-4"},zt=["src"],St={class:"flex flex-col"},Ut={class:"font-medium"},qt={class:"text-xs text-foreground/70"},Bt={class:"flex flex-1 flex-col gap-1"},It={class:"line-clamp-2 text-sm text-foreground/60"},At={class:"mt-1 flex flex-wrap gap-1 text-sm text-foreground/60"},Nt=K({__name:"voice-select",emits:["select"],setup(t,{expose:m,emit:x}){const R=D(),U=D(),h=g(!1),c=g(0),w=g(""),V=g([]),O=g([]),b=x,d=async()=>{c.value=0,await X(),h.value=!0,V.value=await He()},q=p=>{var l;if(c.value===0)(l=U.value)==null||l.getList({newParams:{keyword:p}});else{const f=p.toLowerCase();O.value=V.value.filter(I=>I.name.toLowerCase().includes(f))}},n=p=>{c.value=p,w.value="",q("")},B=(p,l)=>{const f={type:p,title:l.name,name:"",id:"",cover:l.cover||""};p==="local"?(f.name=l.voice_name,f.id=""):(f.id=l.id,f.name=""),b("select",f),h.value=!1};return m({open:d}),(p,l)=>{const f=Xe,I=Ye,a=ne,v=Qe,S=We,M=Ze,i=ze;return k(),j(i,{modelValue:s(h),"onUpdate:modelValue":l[1]||(l[1]=e=>J(h)?h.value=e:null),title:"选择音色",width:"sm:max-w-5xl"},{default:u(()=>[o("div",ut,[o("div",dt,[o("div",ct,[r(f,{class:"w-fit",ui:{container:"hidden",list:{tab:{padding:"px-4 sm:px-6",active:"text-primary dark:text-white"}}},items:[{label:"我的音色"},{label:"系统音色"}],onChange:n})]),r(I,{modelValue:s(w),"onUpdate:modelValue":l[0]||(l[0]=e=>J(w)?w.value=e:null),fixed:!1,placeholder:"搜索音色",onSearch:q},null,8,["modelValue"])]),o("div",mt,[r(Ve,{name:"component",mode:"out-in"},{default:u(()=>[s(c)===0&&s(h)?(k(),T("div",_t,[r(tt,{ref_key:"listRef",ref:U,"request-instance":()=>s(Ge)({status:s($e).SUCCESS}),scroll:!0,class:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},{default:u(({item:e})=>[o("div",pt,[o("div",ft,[o("div",vt,[r(v,{size:"2xs",orientation:"horizontal",ui:{rounded:"rounded-full"}},{default:u(()=>[r(a,{icon:"heroicons:play",size:"2xs",onClick:_=>{var y;return(y=s(R))==null?void 0:y.open({cover:s(F),url:e.voice_url})}},{default:u(()=>l[2]||(l[2]=[N(" 试听 ")])),_:2},1032,["onClick"]),r(a,{size:"2xs","trailing-icon":"tabler:chevron-right",onClick:_=>B("user",e)},{default:u(()=>l[3]||(l[3]=[N(" 使用 ")])),_:2},1032,["onClick"])]),_:2},1024)])]),o("div",gt,[o("img",{src:e.cover||s(F),class:"relative size-full rounded-full"},null,8,xt)]),o("div",yt,[o("h2",ht,C(e.name||"--"),1),o("p",bt,C(e.record||"--"),1),o("p",wt,C(e.create_time||"--"),1)])])]),_:1},8,["request-instance"])])):(k(),j(M,{key:1},{default:u(()=>[o("div",kt,[(k(!0),T(se,null,oe(s(V),e=>(k(),T("div",{key:e.id,class:"group relative flex cursor-pointer flex-col gap-4 rounded-lg bg-background-soft p-4"},[o("div",Ct,[o("div",$t,[r(v,{size:"2xs",orientation:"horizontal",ui:{rounded:"rounded-full"}},{default:u(()=>[r(a,{icon:"heroicons:play",size:"2xs",onClick:_=>{var y;return(y=s(R))==null?void 0:y.open({cover:s(F),url:e.voiceUrl})}},{default:u(()=>l[4]||(l[4]=[N(" 试听 ")])),_:2},1032,["onClick"]),r(a,{size:"2xs","trailing-icon":"tabler:chevron-right",onClick:_=>B("local",e)},{default:u(()=>l[5]||(l[5]=[N(" 使用 ")])),_:2},1032,["onClick"])]),_:2},1024)])]),o("div",Vt,[o("img",{src:s(F),class:"relative h-12 w-12 rounded-full"},null,8,zt),o("h2",St,[o("span",Ut,C(e.name||"--"),1),o("span",qt,C(e.type),1)])]),o("div",Bt,[o("p",It," 语言："+C(e.language),1),o("p",At,[(k(!0),T(se,null,oe(e.scene,_=>(k(),j(S,{key:_,size:"xs",variant:"soft"},{default:u(()=>[N(C(_),1)]),_:2},1024))),128))])])]))),128))])]),_:1}))]),_:1})])]),r(et,{ref_key:"AudioModalRef",ref:R},null,512)]),_:1},8,["modelValue"])}}}),Rt={class:"flex-1 space-y-4 overflow-y-auto p-4 md:p-6"},Lt={class:"pointer-events-none absolute inset-y-0 start-0 flex items-center px-3"},Mt=["src"],Tt={class:"absolute inset-y-0 end-0 flex items-center px-3.5"},jt={class:"flex items-center gap-2"},Ot={class:"min-w-10 text-end"},Ft={id:"__driver_create__",class:"p-6"},Et={class:"center"},Dt={class:"text-xs text-foreground/50"},Pt={class:"py-2 text-xs center"},Gt={class:"mx-0.5 text-sm font-bold text-primary"},io=K({__name:"options",emits:["refresh"],setup(t,{emit:m}){const{start:x,state:R}=ot([{element:"#__driver_select_voice__",popover:{title:"选择音色",description:"点击唤起音色选择起选择一个你想要的音色"}},{element:"#__driver_title__",popover:{title:"声音标题",description:"填写一个便于查询的标题"}},{element:"#__driver_content__",popover:{title:"内容文本",description:"输入你想要合成的内容，最多900个字"}},{element:"#__driver_speed__",popover:{title:"语速调节",description:"值越大语速越快，反之值越小语速越慢，1x为默认语速"}},{element:"#__driver_create__",popover:{title:"开始合成",description:"点击开始合成声音，任务创建完成后将自动刷新列表"}}],{cache:{key:"__voice_synthesis__",enable:!0}}),U=D(),h=D(),c=g(!1),w=g(!1),V=g("voice_id"),O=m,b=g(E({title:$().required("请填写声音标题"),content:$().required("请填写内容文本")})),d=g(),q={voice_id:"",timbre_name:"",cover:"",title:"",content:"",speed:1,remark:"",model:"V1"},n=Se(Ue(q).cloned.value),B=qe(),p=g(),l=g(0),f=g(!1),I=i=>{d.value=i,i.type==="local"?(V.value="timbre_name",b.value=E({timbre_name:$().required("请选择音色"),title:$().required("请填写声音标题"),content:$().required("请填写内容文本")}),n.voice_id="",n.timbre_name=i.name,n.model="V2"):(V.value="voice_id",b.value=E({voice_id:$().required("请选择音色"),title:$().required("请填写声音标题"),content:$().required("请填写内容文本")}),n.voice_id=i.id,n.timbre_name="",n.model="V1")},a=async()=>{var e,_,y,L;await X();const i=((e=n.content)==null?void 0:e.length)||0;if(n.content&&((_=n.content)==null?void 0:_.length)>900&&(n.content=(y=n.content)==null?void 0:y.slice(0,900),Ae().warn("内容最多为900字")),p.value){if(((L=n.content)==null?void 0:L.length)===0)return l.value=0;if(f.value)return;const P=Math.ceil(i/p.value.voice_words);l.value=P*p.value.voice_power}};async function v(){c.value=!0;try{await st(async()=>{await Je(n)}),Ne(n,q),d.value=void 0,O("refresh"),c.value=!1}catch{c.value=!1}}H(async()=>{var e;if(B.query.voice_data){const _=JSON.parse(await at.decrypt(B.query.voice_data,Be.appSrcret));I(_)}else b.value=E({voice_id:$().required("请选择音色"),title:$().required("请填写声音标题"),content:$().required("请填写内容文本")});p.value=await Ke();const i=(e=h.value)==null?void 0:e.textarea;i&&(i.addEventListener("compositionstart",S),i.addEventListener("compositionend",M)),x()});const S=()=>{f.value=!0},M=()=>{f.value=!1,a()};return Ie(()=>{var e;const i=(e=h.value)==null?void 0:e.textarea;i&&(i.removeEventListener("compositionstart",S),i.removeEventListener("compositionend",M))}),(i,e)=>{const _=Me,y=Te,L=je,P=Oe,le=De,re=Fe,ie=Ee,ue=Pe,de=ne,ce=Re;return k(),j(ce,{schema:s(b),state:s(n),class:"flex h-full flex-col","validate-on":["submit"],onSubmit:v},{default:u(()=>{var Y,Q;return[o("div",Rt,[r(L,{id:"__driver_select_voice__",label:"选择音色",name:s(V),size:"lg",required:""},{default:u(()=>{var z,W,Z;return[o("div",{class:"relative flex h-10 w-full cursor-pointer select-none rounded-md border-0 bg-gray-50 px-3.5 py-2.5 pe-11 ps-11 text-sm text-gray-900 placeholder-gray-400 shadow-sm ring-1 ring-inset ring-gray-300 active:bg-gray-100 dark:bg-gray-800 dark:text-white dark:placeholder-gray-500 dark:ring-gray-700 dark:active:bg-gray-900",onClick:e[0]||(e[0]=Ht=>{var ee;return(ee=s(U))==null?void 0:ee.open()})},[o("span",Lt,[s(d)===void 0?(k(),j(_,{key:0,icon:"tabler:volume",ui:{icon:{base:"text-white"}},class:"bg-primary",size:"xs",alt:"Avatar"})):(z=s(d))!=null&&z.cover?(k(),j(_,{key:1,src:(W=s(d))==null?void 0:W.cover,class:"bg-background",size:"xs",alt:"Avatar"},null,8,["src"])):(k(),T("img",{key:2,src:s(F),class:"size-6 rounded-full bg-background",size:"xs",alt:"Avatar"},null,8,Mt))]),o("span",{class:ae(["truncate",{"text-foreground/55":!s(d)}])},C(((Z=s(d))==null?void 0:Z.title)||"未选择音色"),3),o("span",Tt,[r(y,{name:"heroicons:chevron-up-down-solid",class:"iconify i-heroicons:chevron-up-down-20-solid h-5 w-5 flex-shrink-0 text-gray-400 dark:text-gray-500"})])])]}),_:1},8,["name"]),r(L,{id:"__driver_title__",label:"声音标题",name:"title",size:"lg",required:""},{default:u(()=>[r(P,{modelValue:s(n).title,"onUpdate:modelValue":e[1]||(e[1]=z=>s(n).title=z),placeholder:"请填写声音标题",color:"gray"},null,8,["modelValue"])]),_:1}),r(L,{id:"__driver_content__",label:"内容文本",name:"content",required:"",hint:`${(Y=s(n).content)==null?void 0:Y.length}/900`},{help:u(()=>e[5]||(e[5]=[o("span",{class:"text-xs"},"字数上限为900字，使用标点符号控制停顿",-1)])),default:u(()=>[r(it,{ref_key:"textareaRef",ref:h,modelValue:s(n).content,"onUpdate:modelValue":e[2]||(e[2]=z=>s(n).content=z),color:"gray",resize:"",variant:"outline",rows:5,placeholder:"请填写需要合成的内容文本",onChange:a,onInput:a},null,8,["modelValue"])]),_:1},8,["hint"]),r(L,{id:"__driver_speed__",label:"语速调节",name:"speed",required:""},{help:u(()=>e[6]||(e[6]=[o("span",{class:"text-xs"},"范围在0.1x～2x，值越大语速越快，1x为默认语速",-1)])),default:u(()=>[o("div",jt,[r(le,{modelValue:s(n).speed,"onUpdate:modelValue":e[3]||(e[3]=z=>s(n).speed=z),step:.1,min:.1,max:2},null,8,["modelValue"]),o("span",Ot,C(s(n).speed)+"x",1)])]),_:1})]),o("div",Ft,[r(ue,null,{default:u(()=>[o("p",Et,[r(ie,{modelValue:s(w),"onUpdate:modelValue":e[4]||(e[4]=z=>J(w)?w.value=z:null),ui:{inner:"ms-2",base:"size-3.5",wrapper:"items-center"}},{label:u(()=>[o("p",Dt,[e[8]||(e[8]=o("span",null,"请先阅读并同意",-1)),r(re,{target:"_blank",class:"mx-[1px] font-medium text-primary",to:"/agreement?type=agreement&item=use"},{default:u(()=>e[7]||(e[7]=[N(" 《使用协议》 ")])),_:1})])]),_:1},8,["modelValue"])])]),_:1}),o("p",Pt,[e[9]||(e[9]=N(" 预计消耗 ")),o("span",Gt,C(s(l)),1),N(" "+C((Q=("useAppStore"in i?i.useAppStore:s(Le))().siteConfig)==null?void 0:Q.unit.power),1)]),r(de,{disabled:!s(w),loading:s(c),class:"w-full",type:"submit",ui:{rounded:"rounded-full"},block:"",size:"lg"},{default:u(()=>[o("span",null,C(s(c)?"创建任务中":"开始合成"),1)]),_:1},8,["disabled","loading"])]),r(Nt,{ref_key:"VoiceSelectRef",ref:U,onSelect:I},null,512)]}),_:1},8,["schema","state"])}}});export{io as _};
