import{_ as Q}from"./DIFg_cFK.js";import{f as X,r as w,y as Y,L as U,bB as M,h as Z,ab as ee,U as g,j as te,o as c,c as u,b as _,k as o,a7 as oe,a as m,n as S,v as A,t as C,B as h,x as re,av as se,ap as ae,bC as le,bD as ne,$ as I,bE as V,bF as ie,_ as ce}from"./iBiA3qHo.js";import{_ as ue}from"./B37HoT1E.js";const $={video:'<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 6.504h9.75c2.107 0 3.16 0 3.917.507c.327.219.608.5.827.828C22 8.597 22 9.891 22 12M12 6.504l-.633-1.268c-.525-1.05-1.005-2.108-2.168-2.545C8.69 2.5 8.108 2.5 6.944 2.5c-1.816 0-2.724 0-3.406.38A3 3 0 0 0 2.38 4.04C2 4.722 2 5.63 2 7.45v3.059c0 4.72 0 7.079 1.464 8.545C4.578 20.169 6.21 20.436 9 20.5m10.5-3.854l.063-.045c1.058-.764 1.587-1.146 2.012-.961s.425.795.425 2.018v.684c0 1.223 0 1.834-.425 2.018c-.425.185-.954-.197-2.012-.96l-.063-.046m-4 2.146h.5c1.65 0 2.475 0 2.987-.448c.513-.449.513-1.17.513-2.614v-.875c0-1.444 0-2.166-.513-2.614C18.475 14.5 17.65 14.5 16 14.5h-.5c-1.65 0-2.475 0-2.987.448c-.513.449-.513 1.17-.513 2.614v.875c0 1.444 0 2.166.513 2.614c.512.449 1.337.449 2.987.449" color="currentColor"/></svg>',image:'<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" color="currentColor"><path d="M11.508 2.99c-4.483 0-6.724 0-8.117 1.392C2 5.774 2 8.015 2 12.496s0 6.722 1.392 8.114c1.393 1.392 3.634 1.392 8.117 1.392s6.724 0 8.117-1.392c1.392-1.392 1.392-3.633 1.392-8.114v-.5"/><path d="M4.999 20.99c4.21-4.752 8.94-11.053 16-6.327M17.996 1.998v8.008M22 5.977l-8.01.015"/></g></svg>',audio:'<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.009 20.5c-4.718 0-7.078 0-8.543-1.465C2 17.572 2 15.215 2 10.5V7.444c0-1.816 0-2.724.38-3.406A3 3 0 0 1 3.54 2.88c.682-.38 1.59-.38 3.409-.38c1.164 0 1.747 0 2.257.191c1.164.436 1.644 1.493 2.169 2.542l.634 1.267m-5.005 0h9.759c2.108 0 3.163 0 3.92.506c.328.218.61.5.829.827c.34.51.452 1.155.488 2.167m-1 8.583v-3.166c0-1.769 0-2.653-.54-2.873s-1.176.405-2.447 1.656c-.662.651-1.047.791-1.971.791c-.82 0-1.229 0-1.523.194C13.915 15.58 14 16.363 14 17s-.085 1.419.519 1.815c.294.194.704.194 1.523.194c.924 0 1.309.14 1.97.791c1.272 1.251 1.908 1.877 2.448 1.656c.54-.22.54-1.104.54-2.873" color="currentColor"/></svg>',file:'<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M18 13.5v8m4-4h-8m-7-11h9.75c2.107 0 3.16 0 3.917.506a3 3 0 0 1 .827.827c.465.695.502 1.851.505 3.667M12 6.5l-.633-1.267c-.525-1.05-1.005-2.106-2.168-2.542C8.69 2.5 8.108 2.5 6.944 2.5c-1.816 0-2.724 0-3.406.38A3 3 0 0 0 2.38 4.038C2 4.72 2 5.628 2 7.444V10.5c0 4.714 0 7.071 1.464 8.535C4.822 20.394 6.944 20.493 11 20.5" color="currentColor"/></svg>',folder:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.5 20.5H12c-4.714 0-7.071 0-8.536-1.465C2 17.572 2 15.215 2 10.5V7.444c0-1.816 0-2.724.38-3.406A3 3 0 0 1 3.538 2.88c.682-.38 1.59-.38 3.406-.38c1.164 0 1.746 0 2.255.191c1.163.436 1.643 1.493 2.168 2.542L12 6.5m-5 0h9.75c2.107 0 3.16 0 3.917.506a3 3 0 0 1 .827.827C22 8.59 22 9.393 22 11.5m-1 4.462v2.461c0 1.7-1.343 3.077-3 3.077s-3-1.378-3-3.077V15.04c0-.85.672-1.539 1.5-1.539s1.5.689 1.5 1.539v3.384" color="currentColor"/></svg>'},de={key:0,class:"pointer-events-none absolute z-[1] size-full rounded-md"},pe={class:"size-full flex-col gap-1 text-gray-400 center dark:text-gray-500"},fe={key:0,class:"text-xs text-red-500"},me={key:1,class:"text-xs"},he={key:1,class:"absolute inset-0 z-[1] size-full rounded-md"},ve={key:0,class:"group absolute inset-0 z-[1] size-full cursor-pointer rounded-md"},ge=["src"],we=["src"],_e={key:2,class:"flex size-full flex-col justify-center px-4"},ye={class:"truncate text-sm center"},xe={key:3,class:"size-full gap-2 rounded-md center"},ke={class:"text-primary"},be={class:"text-sm text-primary"},Ce={class:"absolute bottom-0 left-0 flex w-full translate-y-0 overflow-hidden rounded-b-md bg-black/30 opacity-0 backdrop-blur-lg transition-[transform,opacity] group-hover:translate-y-6 group-hover:opacity-100 dark:bg-gray-800"},De=["download","href"],ze={key:1,class:"absolute inset-0 z-50 size-full flex-col overflow-hidden rounded-md px-4 backdrop-blur-lg center"},Me={class:"text-xs text-foreground/60"},Ve=X({__name:"pro-uploader",props:{modelValue:{default:""},type:{default:"image"},text:{default:""},icon:{default:""},square:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},class:{default:""},maxSize:{default:200},maxDuration:{default:void 0},minDuration:{default:0},disabled:{type:Boolean,default:!1},accept:{default:""}},emits:["update:modelValue","change","clear","loaded:video","loaded:audio"],setup(L,{emit:R}){const t=L,y=R,E=w(0),j=w(!1),p=w(0),r=w({file:null,url:"",duration:0}),D=Y(),T=w(),x=w(""),B=U(()=>t.accept?t.accept:t.type==="image"?M.IMAGE:t.type==="file"?M.FILE:t.type==="audio"?M.AUDIO:M.VIDEO);Z(()=>{t.modelValue&&F(t.modelValue)}),ee(()=>t.modelValue,e=>{e&&F(e)});const F=e=>{if(j.value)return;j.value=!0;const s=t.modelValue.split(".").pop(),a=B.value.split(",");if(!a.includes(`.${s}`)&&!a.includes(`.${s==null?void 0:s.toLowerCase()}`)){const d="文件类型不匹配";throw v(),f(d),g().warn(d),new Error(d)}p.value=2,r.value.url=e},N=U(()=>{if(!t.class)return"h-28 w-full";const e=t.class.split(/\s+/),s=e.some(i=>/^h-/.test(i)),a=e.some(i=>/^w-/.test(i)),d=e.some(i=>/^size-/.test(i));return!s&&!d&&e.push("h-28"),!a&&!d&&e.push("w-full"),e.join(" ")}),O=U(()=>t.text?t.text:`点击上传${{image:"图片",video:"视频",audio:"音频",file:"文件"}[t.type]}`),P=async e=>(p.value=1,se({image:"image",audio:"file",video:"video",file:"file"}[t.type],{file:e},{onUploadProgress:a=>{a.total&&(E.value=Math.round(a.loaded/a.total*100))}})),G=e=>{try{const{size:s,type:a,name:d}=e;if(s>t.maxSize*1024*1024){const n=`文件大小不能超过${ae(t.maxSize*1024*1024)}`;throw v(),f(n),g().warn(n),new Error(n)}const i=le(a),k=B.value.split(",");if(!k.includes(i)&&!k.includes(i==null?void 0:i.toLowerCase())){const n="文件类型不匹配";throw v(),f(n),g().warn(n),new Error(n)}const b=URL.createObjectURL(e),z={image:n=>{},video:async n=>{if(r.value.duration=await ne(b),!I()){if(t.minDuration>0&&r.value.duration<t.minDuration){const l=`视频时长不能小于${V(t.minDuration)}`;throw v(),f(l),g().warn(l),new Error(l)}if(t.maxDuration&&r.value.duration>t.maxDuration){const l=`视频时长不能超过${V(t.maxDuration)}`;throw v(),f(l),g().warn(l),new Error(l)}}},audio:async n=>{if(r.value.duration=await ie(b),!I()){if(t.minDuration>0&&r.value.duration<t.minDuration){const l=`音频时长不能小于${V(t.minDuration)}`;throw v(),f(l),g().warn(l),new Error(l)}if(t.maxDuration&&r.value.duration>t.maxDuration){const l=`音频时长不能超过${V(t.maxDuration)}`;throw v(),f(l),g().warn(l),new Error(l)}}},file:n=>{}};return W(e),z[t.type](e)}catch(s){f(s),console.error(s)}},H=async e=>{const s=e[0];s&&(K(),await G(s),P(s).then(a=>{y("update:modelValue",a.uri),y("change",{...a,...r.value}),g().success("上传成功"),p.value=2}).catch(a=>{console.error(a),f("上传失败"),p.value=0}))},q=()=>{var e;(e=D.value)==null||e.input.click()},v=()=>{y("update:modelValue",""),J(),D.value&&(D.value.input.value=""),p.value=0,y("clear")},W=e=>{r.value.file=e,r.value.url=URL.createObjectURL(e)},J=()=>{r.value.file=null,r.value.url="",r.value.duration=0},f=(e,s)=>{x.value=e},K=()=>{x.value=""};return(e,s)=>{var b,z,n;const a=Q,d=re,i=ue,k=te("dompurify-html");return c(),u("div",{class:A(["form-input focus-within:ring-primary-500 dark:focus-within:ring-primary-400 relative block w-full rounded-md border-0 bg-gray-50 p-0 text-sm text-gray-900 placeholder-gray-400 shadow-sm ring-1 ring-inset ring-gray-300 file:mr-1.5 file:border-0 file:bg-transparent file:p-0 file:font-medium file:text-gray-500 file:outline-none focus-within:outline-none focus-within:ring-2 dark:bg-gray-800 dark:text-white dark:placeholder-gray-500 dark:ring-gray-700 dark:file:text-gray-400",[o(N),e.disabled?"cursor-not-allowed opacity-75":""]])},[_(oe,{id:"__pro_uploader__",ref_key:"fileInputRef",ref:D,type:"file",color:"gray",class:"size-full",disabled:e.disabled,ui:{wrapper:"absolute",base:"inset-0 w-full h-full cursor-pointer opacity-0"},accept:o(B),onChange:H},null,8,["disabled","accept"]),o(p)===0?(c(),u("div",de,[m("div",pe,[S(m("i",{class:A(["text-xl",o(x)!==""?"text-red-500":""])},null,2),[[k,o($)[e.type]]]),o(x)!==""?(c(),u("p",fe,C(o(x)),1)):(c(),u("p",me,C(o(O)),1))])])):h("",!0),o(p)!==0?(c(),u("div",he,[o(p)===2?(c(),u("div",ve,[e.type==="image"?(c(),u("img",{key:0,src:o(r).url,class:"size-full rounded-md object-contain",alt:""},null,8,ge)):h("",!0),e.type==="video"&&o(r).url?(c(),u("video",{key:1,ref_key:"videoRef",ref:T,preload:"",class:"size-full rounded-md object-contain",src:o(r).url,controls:""},null,8,we)):h("",!0),e.type==="audio"&&o(r).url?(c(),u("div",_e,[m("p",ye,C((b=o(r).file)==null?void 0:b.name),1),_(a,{src:o(r).url,onGetDuration:s[0]||(s[0]=l=>y("loaded:audio",l))},null,8,["src"])])):h("",!0),e.type==="file"&&o(r).url?(c(),u("div",xe,[S(m("i",ke,null,512),[[k,o($).folder]]),m("span",be,C((z=o(r).file)==null?void 0:z.name),1)])):h("",!0),m("div",Ce,[m("span",{class:"flex-1 cursor-pointer p-2 center hover:bg-primary",onClick:q},[_(d,{name:"tabler:reload",class:"text-white"})]),m("span",{class:"flex-1 cursor-pointer p-2 center hover:bg-red-500",onClick:v},[_(d,{name:"tabler:trash",class:"text-white"})]),o(r).file?(c(),u("a",{key:0,download:(n=o(r).file)==null?void 0:n.name,href:o(r).url,class:"flex-1 cursor-pointer p-2 center hover:bg-green-500"},[_(d,{name:"tabler:download",class:"text-white"})],8,De)):h("",!0)])])):h("",!0),o(p)===1?(c(),u("div",ze,[_(i,{class:"my-2",value:o(E),indicator:""},null,8,["value"]),m("p",Me,C(o(E)===100?"上传成功":"正在上传"),1)])):h("",!0)])):h("",!0)],2)}}}),je=ce(Ve,[["__scopeId","data-v-a06d0ef6"]]);export{je as _};
