import{f as S,r,W as $,T as B,X as F,Y as w,bO as O,o as N,A as D,w as n,k as e,l as I,an as T,af as j,b as t,bP as v,a as A,d as G,t as M,bQ as Q,x as R,a7 as W,a8 as X,q as Y,a3 as h}from"./iBiA3qHo.js";const E={class:"flex justify-end gap-2"},K=S({__name:"editPassword",emits:["refresh"],setup(H,{expose:b,emit:g}){const x=g,y=r(null),V=$(),l=r(!1),d=r(!1),i=r(!1),p=r(!1),u=r(!1),s=B({old_password:"",password:"",password_confirm:""}),U=F({old_password:w().min(6,"密码不能少于6位").required("原密码不能为空"),password:w().min(6,"新密码不能少于6位").required("密码不能为空"),password_confirm:w().min(6,"新密码不能少于6位").required("请再次输入密码").oneOf([O("password")],"两次输入的新密码不一致")}),k=m=>{m&&(T(s,{old_password:"",password:"",password_confirm:""}),l.value=!1,d.value=!1,i.value=!1,y.value=m,p.value=!0)};async function q(){u.value=!0;try{await Q(s),V.getUser(),p.value=!1,u.value=!1,x("refresh")}catch{u.value=!1}}return b({open:k}),(m,o)=>{const c=R,f=W,_=X,z=Y,C=h,P=j;return N(),D(P,{modelValue:e(p),"onUpdate:modelValue":o[6]||(o[6]=a=>I(p)?p.value=a:null),title:"修改密码"},{default:n(()=>[t(C,{state:e(s),schema:e(U),class:"my-4 space-y-4",onSubmit:q},{default:n(()=>[t(_,{label:"原密码",name:"old_password",size:"lg",required:""},{default:n(()=>[t(f,{modelValue:e(s).old_password,"onUpdate:modelValue":o[1]||(o[1]=a=>e(s).old_password=a),placeholder:"请填写原密码",color:"gray",type:e(l)?"text":"password",class:"flex-1",ui:{icon:{trailing:{pointer:"pointer-events-auto"}}}},v({_:2},[e(s).old_password?{name:"trailing",fn:n(()=>[t(c,{name:e(l)?"tabler:eye-off":"tabler:eye",class:"cursor-pointer text-foreground/70",size:20,onClick:o[0]||(o[0]=a=>l.value=!e(l))},null,8,["name"])]),key:"0"}:void 0]),1032,["modelValue","type"])]),_:1}),t(_,{label:"新密码",name:"password",size:"lg",required:""},{default:n(()=>[t(f,{modelValue:e(s).password,"onUpdate:modelValue":o[3]||(o[3]=a=>e(s).password=a),placeholder:"请填写新密码",color:"gray",type:e(d)?"text":"password",class:"flex-1",ui:{icon:{trailing:{pointer:"pointer-events-auto"}}}},v({_:2},[e(s).password?{name:"trailing",fn:n(()=>[t(c,{name:e(d)?"tabler:eye-off":"tabler:eye",class:"cursor-pointer text-foreground/70",size:20,onClick:o[2]||(o[2]=a=>d.value=!e(d))},null,8,["name"])]),key:"0"}:void 0]),1032,["modelValue","type"])]),_:1}),t(_,{label:"确认新密码",name:"password_confirm",size:"lg",required:""},{default:n(()=>[t(f,{modelValue:e(s).password_confirm,"onUpdate:modelValue":o[5]||(o[5]=a=>e(s).password_confirm=a),placeholder:"请再次填写新密码",color:"gray",type:e(i)?"text":"password",class:"flex-1",ui:{icon:{trailing:{pointer:"pointer-events-auto"}}}},v({_:2},[e(s).password_confirm?{name:"trailing",fn:n(()=>[t(c,{name:e(i)?"tabler:eye-off":"tabler:eye",class:"cursor-pointer text-foreground/70",size:20,onClick:o[4]||(o[4]=a=>i.value=!e(i))},null,8,["name"])]),key:"0"}:void 0]),1032,["modelValue","type"])]),_:1}),A("div",E,[t(z,{type:"submit",class:"px-8",size:"lg",loading:e(u),disabled:!e(s).old_password||!e(s).password||!e(s).password_confirm},{default:n(()=>{var a;return[G(M((a=e(y))!=null&&a.has_password?"确认修改":"立即设置"),1)]}),_:1},8,["loading","disabled"])])]),_:1},8,["state","schema"])]),_:1},8,["modelValue"])}}});export{K as _};
