import{f as ue,u as ce,$ as G,p as me,h as pe,y as h,r as m,X as _e,T as fe,o as c,A as v,w as r,a as t,b as l,k as s,l as T,c as y,d as g,t as P,v as U,B as x,ae as S,ar as E,a5 as ve,ad as M,as as ge,aq as xe,at as be,au as ke,av as he,an as ye,q as we,x as Ce,a7 as Ve,a8 as ze,e as Te,a9 as Pe,a3 as Ue,af as $e}from"./iBiA3qHo.js";import{_ as Re,a as Fe}from"./CTy8_DAc.js";import{_ as Be}from"./B8-tLZve.js";import{_ as Se,a as Me}from"./CQds3MU0.js";import{_ as Le}from"./C6WHBLMF.js";import{_ as Ie}from"./Cb4KlQxU.js";import{_ as qe}from"./BRU1X883.js";import{a as Ne,b as je,c as Ae}from"./DxM3l_Qq.js";import{_ as De}from"./izpi8Ziy.js";import{_ as Ge}from"./DU3fwEm4.js";import{_ as Ee}from"./C2YhYPVG.js";import{_ as Oe}from"./B2dqla-H.js";import{u as He}from"./BCw_9tXi.js";import"./DPda_AxG.js";import"./DIFg_cFK.js";import"./jEpb_vT2.js";import"./B37HoT1E.js";import"./DluhCU7w.js";import"./D81t8MNF.js";import"./BLDARQqd.js";import"./75-SRlBf.js";import"./DxqbCNiF.js";import"./BoJhwiBp.js";import"./DQcmSzy7.js";import"./BK3-fmoW.js";import"./DH1JQC-z.js";import"./DJTJLgCP.js";import"./M2xpECKh.js";import"./hQShq2XZ.js";const Ke=""+new URL("1.CgBIZBFn.png",import.meta.url).href,We=""+new URL("2.B5KdM0Z9.png",import.meta.url).href,Ze=""+new URL("3.BW9uqhh5.png",import.meta.url).href,Xe={class:"flex items-center gap-2"},Je={class:"flex flex-col justify-between gap-4 md:mb-4 md:flex-row md:items-center"},Qe={key:1,class:"md:h-10"},Ye={class:"flex items-center gap-2"},et=["onClick"],tt={class:"relative"},st={key:0,class:"absolute inset-0 z-10 size-full gap-4 bg-black/10 opacity-0 backdrop-blur transition-opacity center hover:opacity-100"},at={class:"flex flex-col items-center gap-1"},ot={key:0,class:"flex flex-col items-center gap-1"},lt={class:"p-3"},nt={class:"flex items-center justify-between"},rt={class:"text-xs text-foreground/60"},it={class:"flex items-center gap-1"},dt={id:"__driver_create_video_form__",class:"flex-1 space-y-4"},ut={class:"flex flex-col text-xs"},ct={key:0},mt={class:"flex-1 md:flex md:flex-col"},pt={id:"__driver_create_video_rule__",class:"rounded-lg bg-background-soft p-4 md:bg-transparent md:p-0"},_t={class:"relative mt-1 grid grid-cols-3 gap-4"},ft={class:"flex-col center"},vt=["src"],gt={class:"mt-1 flex items-center gap-1"},xt={class:"flex-col center"},bt=["src"],kt={class:"mt-1 flex items-center gap-1"},ht={class:"flex-col center"},yt=["src"],wt={class:"mt-1 flex items-center gap-1"},Ct={class:"mb-4 mt-4 md:mt-auto md:center"},Vt={class:"text-xs text-foreground/50"},as=ue({__name:"index",setup(zt){ce({title:"我的形象"});const{start:O,state:Tt,next:L}=He([{element:G()?"#__driver_addonce_h5__":"#__driver_addonce__",popover:{title:"新建形象",description:"点击打开新建面板",onNextClick:async()=>{p.value=!0,await me(),L()}}},{element:"#__driver_create_video_rule__",popover:{title:"形象要求",description:"仔细阅读形象视频要求，否则可能无法正常合成数字人"}},{element:"#__driver_create_video_form__",popover:{title:"形象信息",description:"上传形象视频，填写形象相关信息"}},{element:"#__driver_create_video_start__",popover:{title:"开始创建",description:"点击开始创建数字人形象",onNextClick:()=>{p.value=!1,L()}}}],{cache:{key:"__avatar_generator__",enable:!0}});pe(()=>{O()});const $=h(),I=h(),q=h(),N=h(),b=h(),p=m(!1),i=m(!1),u=m([]),w=m(!1),R=m(null),H=m(0),F=m(""),C=m(!1),j=m(!1),K=_e({}),A={cover:"",name:"",file_id:"",duration:0},d=fe({...A}),W=a=>{var e;(e=b.value)==null||e.getList({newParams:{keyword:a},resetPage:!0})},Z=a=>{if(u.value.includes(a)){u.value=u.value.filter(e=>e!==a);return}u.value.push(a)},V=m(""),X=async a=>{if(d.duration=a.duration||0,d.file_id=a.id,a.file){const e=URL.createObjectURL(a.file);R.value=await ge(e,xe(".png"))}},J=a=>{const e=[[{label:"详情",icon:"i-tabler:info-circle",click:()=>{var n;return(n=$.value)==null?void 0:n.show(a)}}],[{label:"删除",icon:"i-heroicons-trash-20-solid",iconClass:"text-red-500",labelClass:"text-red-500",click:()=>{var n;(n=q.value)==null||n.open({message:`确认要删除 《${a.name}》 吗？`,title:"删除形象",confirm:async()=>{var z;await Ae({id:a.id}),(z=b.value)==null||z.getList()}})}}]];return a.video_url&&e[0].push({label:"下载",icon:"i-tabler:download",click:()=>{be({src:a.video_url})}}),e},Q=a=>{var n;const e=["","1","0","2"];(n=b.value)==null||n.getList({newParams:{status:e[a]},resetPage:!0})},Y=async()=>{var a;try{if(C.value=!0,!d.cover&&!ke()&&R.value){const e=await he("image",{file:R.value},{onUploadProgress:n=>{n.total&&(H.value=Math.round(n.loaded/n.total*100))}});d.cover=e.uri,j.value=!0}await je(d),ye(d,A),V.value="",(a=b.value)==null||a.refresh(),p.value=!1,C.value=!1}catch{C.value=!1}};return(a,e)=>{const n=we,z=Re,ee=Fe,_=Ce,te=Be,se=Me,ae=Ve,B=ze,D=Le,oe=Ie,le=Te,ne=Pe,re=Ue,ie=$e,de=qe;return c(),v(de,{scroll:!0,breadcrumb:"我的形象","mobile-back":!1,padding:!0,background:!0},{"breadcrumb-right":r(()=>[t("div",Xe,[l(n,{class:"md:order-1 md:hidden",icon:"tabler:clock",variant:"soft",size:"md",to:"/avatar/works"}),l(n,{class:"md:order-1 md:hidden",icon:s(i)?"tabler:x":"tabler:list-check",size:"md",variant:s(i)?"outline":"solid",onClick:e[0]||(e[0]=()=>{s(i)&&(u.value=[]),i.value=!s(i)})},null,8,["icon","variant"]),l(n,{id:"__driver_addonce_h5__",class:"md:order-1 md:hidden",icon:"tabler:plus",size:"md",onClick:e[1]||(e[1]=o=>p.value=!0)}),l(z,{modelValue:s(F),"onUpdate:modelValue":e[2]||(e[2]=o=>T(F)?F.value=o:null),onSearch:W},null,8,["modelValue"])])]),default:r(()=>[t("div",Je,[s(i)?(c(),y("div",Qe)):(c(),v(ee,{key:0,class:"overflow-hidden sm:w-fit",ui:{container:"hidden",list:{tab:{padding:"px-4 sm:px-6",active:"text-primary dark:text-white"}}},items:[{label:"全部"},{label:"完成"},{label:"进行中"},{label:"失败"}],onChange:Q})),t("div",Ye,[l(n,{id:"__driver_addonce__",class:"hidden md:flex",ui:{rounded:"rounded-full",padding:{sm:"px-4"}},onClick:e[3]||(e[3]=o=>p.value=!0)},{default:r(()=>e[13]||(e[13]=[g(" 新建 ")])),_:1}),l(n,{id:"__driver_addbatch__",class:"hidden md:flex",ui:{rounded:"rounded-full",icon:{size:{sm:"h-4 h-4"}}},icon:s(i)?"tabler:x":"tabler:list-check",onClick:e[4]||(e[4]=()=>{s(i)&&(u.value=[]),i.value=!s(i)})},{default:r(()=>[g(P(s(i)?"取消批量":"批量合成"),1)]),_:1},8,["icon"]),s(u).length>0?(c(),v(n,{key:0,id:"__driver_start__",class:U({"fixed bottom-20 left-1/2 z-[999] -translate-x-1/2 md:static md:translate-x-0":s(u).length>0}),ui:{rounded:"rounded-full",padding:{sm:"px-4"}},onClick:e[5]||(e[5]=()=>{var o;(o=s(I))==null||o.open(s(u)),i.value=!1})},{default:r(()=>e[14]||(e[14]=[g(" 开始合成 ")])),_:1},8,["class"])):x("",!0)])]),l(Ge,{ref_key:"listRef",ref:b,"request-instance":s(Ne),polling:o=>o.filter(f=>("isTaskPendding"in a?a.isTaskPendding:s(M))(f.status)).length===0,scroll:!0,class:"grid grid-cols-1 gap-4 p-0.5 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5"},{default:r(({item:o})=>[t("div",{class:U(["relative flex flex-col overflow-hidden rounded-lg bg-background shadow dark:bg-gray-800",{"opacity-70":("isTaskPendding"in a?a.isTaskPendding:s(M))(o.status)||("isTaskInvalid"in a?a.isTaskInvalid:s(E))(o.status),"bg-red-50 dark:opacity-50":("isTaskFail"in a?a.isTaskFail:s(S))(o.status)}])},[s(i)?(c(),y("div",{key:0,class:"absolute left-0 top-0 z-[100] flex size-full cursor-pointer justify-end rounded-lg bg-foreground/20 p-2",onClick:f=>Z(o)},[s(u).find(f=>f.id===o.id)?(c(),v(_,{key:0,name:"tabler:square-rounded-check-filled",class:"text-primary",size:"28"})):(c(),v(_,{key:1,name:"tabler:square-rounded",class:"text-white",size:"28"}))],8,et)):x("",!0),t("div",tt,[!("isTaskFail"in a?a.isTaskFail:s(S))(o.status)&&o.video_url?(c(),y("div",st,[t("div",at,[l(n,{icon:"i-tabler:player-play-filled",class:"text-white hover:bg-transparent dark:text-white dark:hover:bg-transparent",ui:{rounded:"rounded-full"},size:"lg",variant:"outline",onClick:f=>{var k;return(k=s(N))==null?void 0:k.open(o.video_url)}},null,8,["onClick"]),e[15]||(e[15]=t("span",{class:"text-xs text-white"},"播放",-1))]),("isTaskInvalid"in a?a.isTaskInvalid:s(E))(o.status)?x("",!0):(c(),y("div",ot,[l(n,{icon:"tabler:wand",class:"text-white hover:bg-transparent dark:text-white dark:hover:bg-transparent",ui:{rounded:"rounded-full"},size:"lg",variant:"outline",onClick:f=>{var k;return(k=s($))==null?void 0:k.show(o,1)}},null,8,["onClick"]),e[16]||(e[16]=t("span",{class:"text-xs text-white"},"合成",-1))]))])):x("",!0),l(te,{src:o.cover,class:"bg-background-soft"},null,8,["src"])]),t("div",lt,[t("h1",{class:U(["truncate text-sm",{"text-foreground/80":!o.name}])},P(o.name||"暂无名称"),3),t("div",nt,[t("span",rt,P(o.create_time),1),t("div",it,[t("span",{class:U(["whitespace-nowrap rounded-full border-[0.5px] border-foreground/5 bg-foreground/5 px-1.5 py-0.5 text-xs text-foreground/60 center dark:bg-foreground/10",{"bg-red-100 text-red-500/60 dark:text-foreground/60":("isTaskFail"in a?a.isTaskFail:s(S))(o.status)}])},[g(P({0:"训练中",1:("formatSecond"in a?a.formatSecond:s(ve))(o.duration),2:"训练失败",null:"已失效"}[o.status])+" ",1),("isTaskPendding"in a?a.isTaskPendding:s(M))(o.status)?(c(),v(_,{key:0,name:"tabler:loader-2",class:"animate-spin text-foreground/70"})):x("",!0)],2),l(se,{ui:{width:"w-20",container:"z-[9999] group",item:{icon:{base:"size-4"},padding:"px-1 py-1"}},items:J(o),popper:{placement:"top-end"}},{default:r(()=>[l(n,{size:"2xs",variant:"ghost",ui:{rounded:"rounded-full",icon:{base:"text-foreground/70"}},icon:"i-tabler:dots-vertical"})]),_:2},1032,["items"])])])])],2)]),_:1},8,["request-instance","polling"]),l(ie,{modelValue:s(p),"onUpdate:modelValue":e[11]||(e[11]=o=>T(p)?p.value=o:null),title:"新的形象",width:"sm:max-w-2xl"},{default:r(()=>[l(re,{schema:s(K),state:s(d),class:"flex h-full flex-col space-y-6 md:flex-row md:space-x-6 md:space-y-0","validate-on":["submit"],onSubmit:Y},{default:r(()=>[t("div",dt,[l(B,{label:"形象名称",name:"name",size:"lg",required:""},{default:r(()=>[l(ae,{modelValue:s(d).name,"onUpdate:modelValue":e[6]||(e[6]=o=>s(d).name=o),placeholder:"请填写形象名称",color:"gray"},null,8,["modelValue"])]),_:1}),l(B,{label:"形象视频",name:"avatar",size:"lg",required:""},{help:r(()=>[t("span",ut,[e[17]||(e[17]=t("span",{class:"text-xs text-primary"}," 视频时长在30秒～5分钟，大小最大不超过1GB ",-1)),l(oe,null,{default:r(()=>[("isMobile"in a?a.isMobile:s(G))()?x("",!0):(c(),y("span",ct," PC端打开时系统会自动截取视频第一帧作为封面 "))]),_:1})])]),default:r(()=>[l(D,{modelValue:s(V),"onUpdate:modelValue":e[7]||(e[7]=o=>T(V)?V.value=o:null),class:"h-40",type:"video","max-size":1024,"min-duration":30,"max-duration":300,accept:".mp4,.mov",onClear:e[8]||(e[8]=()=>{s(d).duration=0,s(j)&&(s(d).cover="")}),onChange:X},null,8,["modelValue"])]),_:1}),l(B,{label:"自定义形象封面",name:"avatar",size:"lg"},{help:r(()=>e[18]||(e[18]=[t("span",{class:"flex flex-col text-xs"},[t("span",null," 建议使用16:9比例的.png、.jpg、.jpeg格式的图片。 ")],-1)])),default:r(()=>[l(D,{modelValue:s(d).cover,"onUpdate:modelValue":e[9]||(e[9]=o=>s(d).cover=o),type:"image"},null,8,["modelValue"])]),_:1})]),t("div",mt,[t("div",pt,[t("div",null,[e[22]||(e[22]=t("div",{class:"flex content-center items-center justify-between text-sm"},[t("label",{for:"v-0-38-31",class:"block font-medium text-gray-700 dark:text-gray-200"}," 形象示例 ")],-1)),t("div",_t,[t("div",ft,[t("img",{src:s(Ke),alt:""},null,8,vt),t("p",gt,[l(_,{name:"tabler:circle-check-filled",size:"18",class:"text-green-500"}),e[19]||(e[19]=t("span",{class:"text-xs text-foreground/70"},"正脸自拍",-1))])]),t("div",xt,[t("img",{src:s(We),alt:""},null,8,bt),t("p",kt,[l(_,{name:"tabler:circle-check-filled",size:"18",class:"text-green-500"}),e[20]||(e[20]=t("span",{class:"text-xs text-foreground/70"},"可张口闭口",-1))])]),t("div",ht,[t("img",{src:s(Ze),alt:""},null,8,yt),t("p",wt,[l(_,{name:"tabler:circle-x-filled",size:"18",class:"text-red-500"}),e[21]||(e[21]=t("span",{class:"text-xs text-foreground/70"},"面部有干扰",-1))])])])]),e[23]||(e[23]=t("div",{class:"mt-2"},[t("div",{class:"flex content-center items-center justify-between text-sm"},[t("label",{for:"v-0-38-31",class:"block font-medium text-gray-700 dark:text-gray-200"}," 形象视频要求 ")]),t("div",{class:"relative mt-1 text-xs leading-5 text-foreground/70"},[t("p",null,"1.视频时长要求在30秒～5分钟，文件大小不超过1GB"),t("p",null," 2.为保障效果，视频必须保证每一帧都要正面露脸，脸部无任何遮挡，并且视频中只能出现同一个人脸 "),t("p",null," 3.视频人物建议闭口或微微张口，张口幅度不宜过大；距离镜头一定距离。可根据合成效果自行调整。 "),t("p",null,"4.视频格式为MP4/MOV，建议分辨率1080p~4K")])],-1))]),t("p",Ct,[l(ne,{modelValue:s(w),"onUpdate:modelValue":e[10]||(e[10]=o=>T(w)?w.value=o:null),name:"notifications",label:"Notifications",ui:{inner:"ms-2",base:"size-3.5",wrapper:"items-center"}},{label:r(()=>[t("p",Vt,[e[25]||(e[25]=t("span",null,"请先阅读并同意",-1)),l(le,{target:"_blank",class:"mx-[1px] font-medium text-primary",to:"/agreement?type=agreement&item=use"},{default:r(()=>e[24]||(e[24]=[g(" 《使用协议》 ")])),_:1})])]),_:1},8,["modelValue"])]),l(n,{id:"__driver_create_video_start__",type:"submit",loading:s(C),disabled:!s(w),ui:{rounded:"rounded-full"},block:"",size:"lg"},{default:r(()=>e[26]||(e[26]=[g(" 开始创建 ")])),_:1},8,["loading","disabled"])])]),_:1},8,["schema","state"])]),_:1},8,["modelValue"]),l(Oe,{ref_key:"previewRef",ref:$},null,512),l(Ee,{ref_key:"batchGeneratorRef",ref:I,onClose:e[12]||(e[12]=()=>{u.value=[]})},null,512),l(De,{ref_key:"confirmModalRef",ref:q},null,512),l(Se,{ref_key:"videoPlayerRef",ref:N},null,512)]),_:1})}}});export{as as default};
