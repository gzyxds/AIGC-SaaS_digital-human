import{_ as B}from"./C6WHBLMF.js";import{f as j,r as p,X as P,Y as A,T as D,o as I,A as L,w as a,k as l,l as x,an as g,af as M,a as s,b as o,d as v,p as S,U as G,aq as O,a8 as R,a7 as X,e as Y,a9 as E,q as H,a3 as J}from"./iBiA3qHo.js";import{j as K}from"./BLDARQqd.js";const Q={class:"order-2 mt-2 flex-1"},W={class:"space-y-4"},Z={class:"flex-col gap-2 center"},ee={class:"text-xs text-foreground/50"},oe=j({__name:"local-upload",emits:["refresh"],setup(te,{expose:V,emit:b}){const u=p(!1),i=p(!1),y=P({file_id:A().required("请上传音频文件")}),d=p(!1),f=p(""),U=b,c={cover:"",title:"",file_id:"",duration:0},t=D({...c}),w=()=>{i.value=!0,g(t,c)},k=async()=>{await S(),t.title&&t.title.length>30&&(t.title=t.title.slice(0,30),G().warn("标题最多为30个字"))},h=async m=>{var e,r;t.file_id=m.id,t.duration=m.duration||0,f.value=((r=(e=m.file)==null?void 0:e.name.split("."))==null?void 0:r[0])||O()},C=async()=>{try{d.value=!0,t.title||(t.title=f.value),await K(t),g(t,c),d.value=!1,i.value=!1,U("refresh")}catch{d.value=!1}};return V({show:w}),(m,e)=>{const r=B,_=R,N=X,z=Y,T=E,F=H,$=J,q=M;return I(),L(q,{modelValue:l(i),"onUpdate:modelValue":e[3]||(e[3]=n=>x(i)?i.value=n:null),title:"本地音频上传",width:"sm:max-w-sm"},{default:a(()=>[s("div",Q,[o($,{schema:l(y),state:l(t),class:"flex h-full flex-col space-y-6","validate-on":["submit"],onSubmit:C},{default:a(()=>[s("div",W,[o(_,{label:"音频文件(必填)",name:"file_id",size:"lg",required:""},{help:a(()=>e[4]||(e[4]=[s("span",{class:"flex flex-col text-xs"},[s("span",{class:"text-xs"},"Tips: 音频时长不超过5分钟，仅支持.wav、.mp3格式")],-1)])),default:a(()=>[o(r,{class:"h-24",type:"audio","max-size":200,"max-duration":5*60,accept:".mp3,.wav",onChange:h})]),_:1}),o(_,{label:"音频标题",name:"title",size:"lg"},{help:a(()=>e[5]||(e[5]=[s("span",{class:"flex flex-col text-xs"},[s("span",{class:"text-xs"},"Tips: 标题长度不超过30个字")],-1)])),default:a(()=>[o(N,{modelValue:l(t).title,"onUpdate:modelValue":e[0]||(e[0]=n=>l(t).title=n),placeholder:"请填写音频标题",color:"gray",onChange:k},null,8,["modelValue"])]),_:1}),o(_,{label:"音频头像",name:"cover",size:"lg"},{help:a(()=>e[6]||(e[6]=[s("span",{class:"flex flex-col text-xs"},[s("span",null,"Tips: 建议使用1:1比例的.png、.jpg、.jpeg格式的图片")],-1)])),default:a(()=>[o(r,{modelValue:l(t).cover,"onUpdate:modelValue":e[1]||(e[1]=n=>l(t).cover=n),type:"image"},null,8,["modelValue"])]),_:1})]),s("div",Z,[o(T,{modelValue:l(u),"onUpdate:modelValue":e[2]||(e[2]=n=>x(u)?u.value=n:null),name:"notifications",label:"Notifications",ui:{inner:"ms-2",base:"size-3.5",wrapper:"items-center"}},{label:a(()=>[s("p",ee,[e[8]||(e[8]=s("span",null,"请先阅读并同意",-1)),o(z,{target:"_blank",class:"mx-[1px] font-medium text-primary",to:"/agreement?type=agreement&item=use"},{default:a(()=>e[7]||(e[7]=[v(" 《使用协议》 ")])),_:1})])]),_:1},8,["modelValue"]),o(F,{type:"submit",loading:l(d),disabled:!l(u),ui:{rounded:"rounded-full"},block:"",size:"lg"},{default:a(()=>e[9]||(e[9]=[v(" 开始创建 ")])),_:1},8,["loading","disabled"])])]),_:1},8,["schema","state"])])]),_:1},8,["modelValue"])}}});export{oe as _};
