"use strict";const e=require("../../common/vendor.js"),u=require("../../api/audio.js"),o=require("../../composables/useRecording.js"),r=require("../../enums/variableEnum.js"),n=require("../../composables/useToast.js"),a=require("../../composables/useRequest.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-forms")+e.resolveComponent("layout-default-uni"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-easyinput/uni-easyinput.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms-item/uni-forms-item.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms/uni-forms.js")+t)();const t=()=>"./components/SoundPop2.js",s=e.defineComponent({__name:"index",setup(t){const s=e.ref(),i=e.ref(),l=e.ref(r.RecorderStatusEnum.INIT),{isRecording:c,audioFilePath:d,recordingDuration:m,startRecording:f,stopRecording:v,resetRecording:E,playRecording:R,pauseRecording:p,isPlaying:S}=o.useRecording(),g=e.ref({name:"",record:"",file_id:"",cover:"",duration:0,expected_content:"我的声音将用于平台克隆，并合法使用，为自己的行为负责"}),N={name:{rules:[{required:!0,errorMessage:"请输入声音名称"}]}},I=e.computed((()=>{switch(l.value){case r.RecorderStatusEnum.INIT:return"点击开始录音";case r.RecorderStatusEnum.RECORDING:return"正在录音中...";case r.RecorderStatusEnum.END:return"点击播放";case r.RecorderStatusEnum.PAUSE:return"点击暂停"}}));function P(e){const u=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`}function b(){f(),l.value=r.RecorderStatusEnum.RECORDING}function y(){v(),l.value=r.RecorderStatusEnum.END,console.log("录音时长",m.value),m.value<6?(n.useToast("录音时长至少6秒"),D()):m.value>14?(n.useToast("录音时长最多14秒"),D()):g.value.duration=m.value}function D(){E(),l.value=r.RecorderStatusEnum.INIT,g.value.duration=0}function T(){R(),l.value=r.RecorderStatusEnum.PAUSE}function j(){p(),l.value=r.RecorderStatusEnum.END}const C=e.debounce((async()=>{const u=await i.value.validate();console.log("表单校验通过",u);a.useUpload({type:"file",data:{file:d.value},success:u=>{console.log("上传录音成功",u),g.value.file_id=u.id,e.nextTick$1((()=>{q()}))},fail:e=>{console.log("上传录音失败",e)}}).onProgressUpdate((e=>{console.log("上传进度：",`${e.progress}%`)}))}),800),q=async()=>{await u.apiPostVoiceCreate(g.value),console.log("创建声音 请求成功"),e.index.navigateTo({url:`/bundle/pages/profile/index?type=${r.ProfileTabEnum.MySound}`})};return e.onLoad((()=>{e.nextTick$1((()=>{s.value.open()}))})),(u,o)=>e.e({a:e.o((e=>g.value.name=e)),b:e.p({placeholder:"输入声音名称",modelValue:g.value.name}),c:e.p({label:"",name:"name"}),d:e.sr(i,"9c5d5525-1,9c5d5525-0",{k:"formRef"}),e:e.p({"model-value":g.value,rules:N}),f:e.t(P(e.unref(m))),g:l.value===e.unref(r.RecorderStatusEnum).INIT},l.value===e.unref(r.RecorderStatusEnum).INIT?{h:e.o(b)}:{},{i:l.value===e.unref(r.RecorderStatusEnum).RECORDING},l.value===e.unref(r.RecorderStatusEnum).RECORDING?{j:e.o(y)}:{},{k:l.value===e.unref(r.RecorderStatusEnum).END||l.value===e.unref(r.RecorderStatusEnum).PAUSE},l.value===e.unref(r.RecorderStatusEnum).END||l.value===e.unref(r.RecorderStatusEnum).PAUSE?e.e({l:e.o(D),m:l.value===e.unref(r.RecorderStatusEnum).END},l.value===e.unref(r.RecorderStatusEnum).END?{n:e.o(T)}:{},{o:l.value===e.unref(r.RecorderStatusEnum).PAUSE},l.value===e.unref(r.RecorderStatusEnum).PAUSE?{p:e.o(j)}:{},{q:e.o(((...u)=>e.unref(C)&&e.unref(C)(...u)))}):{},{r:e.t(I.value),s:e.sr(s,"9c5d5525-4,9c5d5525-0",{k:"soundPopRef"})})}}),i=e._export_sfc(s,[["__scopeId","data-v-9c5d5525"]]);wx.createPage(i);
