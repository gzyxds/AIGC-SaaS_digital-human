"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),l=require("../../api/avatar.js"),a=require("../../api/common.js"),i=require("../../api/power.js"),n=require("../../enums/variableEnum.js"),t=require("../../utils/helper.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-forms")+e.resolveComponent("mp-html")+e.resolveComponent("layout-default-uni"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-easyinput/uni-easyinput.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms-item/uni-forms-item.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-data-select/uni-data-select.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms/uni-forms.js")+r+d+u+(()=>"../../uni_modules/mp-html/components/mp-html/mp-html.js"))();const u=()=>"../../components/ConfirmModal.js",r=()=>"./components/SelectProfilePop2.js",d=()=>"./components/SelectTonePop2.js",s=e.defineComponent({__name:"index",setup(u){const r=e.ref(),d=e.ref(),s=e.ref(),v=t.getComponentExpose(),m=e.ref(),c=e.ref(""),p=e.ref(),_=e.ref({voice_mode:1,voice_id:"",content:"",timbre:"",video_id:"",video_mode:null,video_name:""}),f={video_name:{rules:[{required:!0,errorMessage:"请输入数字人名称"}]},video_mode:{rules:[{required:!0,errorMessage:"请选择合成模式"}]},content:{rules:[{required:!0,errorMessage:"请输入需要合成的文本内容"}]}},b=e.computed((()=>_.value.content.length));e.computed((()=>{var e;return(null==(e=g.value.find((e=>e.value===_.value.video_mode)))?void 0:e.video_power)||0}));const g=e.ref([{value:0,text:"极速模式",disable:!1,video_power:0},{value:1,text:"普通模式",disable:!1,video_power:0}]),x=()=>{e.index.navigateTo({url:"/bundle/pages/agreement/index?type=use"})},w=()=>_.value.video_id?_.value.voice_id?void p.value.validate().then((e=>{var o;console.log("表单校验通过",e),null==(o=v.value)||o.open()})).catch((e=>{console.log("表单校验失败",e)})):e.index.showToast({title:"请选择音色",icon:"none"}):e.index.showToast({title:"请选择形象",icon:"none"}),y=e.debounce((async()=>{try{await l.apiPostCreateCompleteFlow({..._.value,timbre:null}),console.log("创建请求成功"),e.index.switchTab({url:"/pages/product/index"})}catch(o){console.log("创建请求失败",o)}}),800);return e.onLoad((o=>{console.log("options =>",o),(null==o?void 0:o.profileId)&&(_.value.video_id=null==o?void 0:o.profileId,s.value=null==o?void 0:o.profileImage),(null==o?void 0:o.soundId)&&(_.value.voice_id=null==o?void 0:o.soundId,_.value.timbre=null==o?void 0:o.soundName),e.nextTick$1((async()=>{await(async()=>{const e=await a.apiGetPolicy(n.AgreementTypeEnum.USE);console.log("协议 =>",e),c.value=e.content})();e.index.getStorageSync(n.VariableEnum.CREATE_DIGITAL_FIRST_ENTRY)||(m.value.open(),e.index.setStorageSync(n.VariableEnum.CREATE_DIGITAL_FIRST_ENTRY,!0)),(async()=>{const e=await i.apiGetAvatarPowerConfigAll();console.log("算力配置 =>",e),g.value=e.map((e=>({value:e.mode,text:`${e.video_mode_title}（${e.video_power}算力/分钟）`,disable:0===e.video_mode_status,video_power:e.video_power})))})()}))})),(l,a)=>e.e({a:s.value},s.value?{b:s.value}:{},{c:!s.value},s.value?{}:{d:o._imports_0$1},{e:!s.value},(s.value,{}),{f:e.o((e=>r.value.open(_.value.video_id||""))),g:e.o((e=>_.value.video_name=e)),h:e.p({placeholder:"请输入数字人名称",type:"text",modelValue:_.value.video_name}),i:e.p({label:"",name:"video_name"}),j:o._imports_1$2,k:!_.value.timbre},(_.value.timbre,{}),{l:_.value.timbre},_.value.timbre?{m:e.t(_.value.timbre)}:{},{n:e.o((e=>d.value.open(_.value.voice_id||""))),o:_.value.content,p:e.o(e.m((e=>_.value.content=e.detail.value),{trim:!0})),q:e.p({label:"",name:"content"}),r:e.o((e=>_.value.content="")),s:e.t(b.value),t:e.o((e=>_.value.video_mode=e)),v:e.p({localdata:g.value,placeholder:"请选择合成模式",placement:"top",clear:!0,modelValue:_.value.video_mode}),w:e.p({label:"",name:"video_mode"}),x:e.sr(p,"5a800017-1,5a800017-0",{k:"formRef"}),y:e.p({"model-value":_.value,rules:f}),z:e.o(w),A:e.o(x),B:e.sr(r,"5a800017-7,5a800017-0",{k:"selectProfilePopRef"}),C:e.o((e=>_.value.video_id=e)),D:e.o((e=>s.value=e)),E:e.p({"profile-id":_.value.video_id,"profile-image":s.value}),F:e.sr(d,"5a800017-8,5a800017-0",{k:"selectTonePopRef"}),G:e.o((e=>_.value.voice_id=e)),H:e.o((e=>_.value.timbre=e)),I:e.p({"sound-id":_.value.voice_id,"sound-name":_.value.timbre}),J:e.sr(v,"5a800017-9,5a800017-0",{k:"payPopupRef"}),K:e.p({title:"创建数字人","cancel-text":"取消","confirm-text":"继续","confirm-callback":e.unref(y)}),L:e.p({content:c.value}),M:e.sr(m,"5a800017-10,5a800017-0",{k:"agreementPopupRef"}),N:e.p({title:"使用协议","show-cancel":!1,"is-mask-click":!1,"confirm-text":"我已知晓并同意"})})}}),v=e._export_sfc(s,[["__scopeId","data-v-5a800017"]]);wx.createPage(v);
