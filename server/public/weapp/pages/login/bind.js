"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/wechat.js");if(!Array){e.resolveComponent("layout-default-uni")()}const a=e.defineComponent({__name:"bind",setup(a){const c=e.ref(),n=e.ref("正在处理，请稍等..."),o=async(e={getUrl:!0})=>{let a=null;const{code:o,key:r="",getUrl:s}=e;if(o)try{a=await apiGetOAAuthBind({code:o,key:r}),c.value=a}catch(l){n.value=error,console.log("绑定失败",l)}s&&await wechatOa.getUrl(t.UrlScene.BIND_WX)};return e.onLoad((a=>{if(a){const{code:n,state:r,scene:s}=a;n&&r&&s&&wechatOa.setAuthData({code:n,scene:s});const l=wechatOa.getAuthData();if(l.code&&l.scene==t.UrlScene.BIND_WX)try{o({...a,...l})}catch(c){e.index.showToast({title:`绑定失败:${c.message||JSON.stringify(c)}`,icon:"error"})}finally{wechatOa.setAuthData()}else a.is_pc&&a.key&&o()}})),(t,a)=>e.e({a:c.value},c.value?{b:c.value.avatar||"/static/logo.png",c:e.t(c.value.nickname||"昵称")}:{d:e.t(n.value)})}});wx.createPage(a);
