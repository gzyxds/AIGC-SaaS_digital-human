"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/wechat.js");if(!Array){e.resolveComponent("layout-default-uni")()}const a=e.defineComponent({__name:"index",setup(a){const n=e.ref(),c=e.ref("正在处理，请稍等..."),o=async(e={getUrl:!0})=>{let a=null;const{code:o,key:s="",getUrl:l}=e;if(o)try{a=await apiGetOALogin({code:o,key:s}),n.value=a}catch(r){c.value=r,console.log(r)}l&&await wechatOa.getUrl(t.UrlScene.PC_LOGIN)};return e.onLoad((a=>{if(a){const{code:c,state:s,scene:l}=a;c&&s&&l&&wechatOa.setAuthData({code:c,scene:l});const r=wechatOa.getAuthData();if(r.code&&r.scene==t.UrlScene.PC_LOGIN)try{o({...a,...r})}catch(n){e.index.showToast({title:`授权失败:${n.message||JSON.stringify(n)}`,icon:"error"})}finally{wechatOa.setAuthData()}else 1==a.is_pc&&a.key&&o()}})),(t,a)=>e.e({a:n.value&&n.value.token},n.value&&n.value.token?{b:n.value.avatar||"/static/logo.png",c:e.t(n.value.nickname||"昵称")}:{d:e.t(c.value)})}});wx.createPage(a);
