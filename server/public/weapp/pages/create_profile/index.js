"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),a=require("../../api/avatar.js"),l=require("../../composables/useRequest.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-forms")+e.resolveComponent("layout-default-uni"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-easyinput/uni-easyinput.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms-item/uni-forms-item.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-forms/uni-forms.js"))();const u=e.defineComponent({__name:"index",setup(u){const i=e.ref(),s=e.ref({name:"",file_id:0,duration:0,cover:""}),n=e.ref(0),r=e.ref(""),t={name:{rules:[{required:!0,errorMessage:"请输入形象名称"}]}},m=()=>{e.index.navigateTo({url:"/bundle/pages/agreement/index"})},d=e.debounce((async()=>{i.value.validate().then((async o=>{console.log("表单校验通过",o),await a.apiPostAvatarVideoCreate(s.value),e.index.navigateTo({url:"/bundle/pages/profile/index"}),console.log("创建形象 请求成功",o)})).catch((e=>{console.log("表单校验失败",e)}))}),800),v=()=>{e.index.chooseMedia({count:1,mediaType:["video"],sourceType:["album","camera"],maxDuration:30,camera:"back",success:e=>{var o,a,u;console.log("视频选择成功",e),console.log("视频封面",null==(o=e.tempFiles[0])?void 0:o.thumbTempFilePath),100===n.value&&(n.value=0,r.value=""),l.useUpload({type:"image",data:{file:null==(a=e.tempFiles[0])?void 0:a.thumbTempFilePath},success:e=>{s.value.cover=e.uri,console.log("视频封面,上传成功",e)},fail:e=>{console.log("视频封面,上传失败",e)}});l.useUpload({type:"video",data:{file:null==(u=e.tempFiles[0])?void 0:u.tempFilePath},success:e=>{console.log(e),s.value.file_id=e.id,r.value=e.uri},fail:e=>{console.log(e)}}).onProgressUpdate((e=>{n.value=e.progress}))},fail:e=>{console.error("视频选择失败",e)}})};return(a,l)=>e.e({a:0===n.value},0===n.value?{b:o._imports_0$1,c:e.o(v)}:{},{d:0===n.value},0===n.value?{e:e.o(v)}:{},{f:n.value>0&&n.value<100},n.value>0&&n.value<100?{g:e.t(n.value)}:{},{h:100===n.value},100===n.value?{i:r.value,j:e.o(v)}:{},{k:o._imports_1$1,l:o._imports_2,m:o._imports_3,n:o._imports_2,o:o._imports_4,p:o._imports_5,q:e.o((e=>s.value.name=e)),r:e.p({placeholder:"请输入形象名称",modelValue:s.value.name}),s:e.p({label:"",name:"name"}),t:e.sr(i,"2533b91e-1,2533b91e-0",{k:"formRef"}),v:e.p({"model-value":s.value,rules:t}),w:e.o(((...o)=>e.unref(d)&&e.unref(d)(...o))),x:e.o(m)})}}),i=e._export_sfc(u,[["__scopeId","data-v-2533b91e"]]);wx.createPage(i);
