"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/user.js"),i=require("../../../enums/variableEnum.js"),n=require("../../../stores/user.js"),u=require("../../../composables/useToast.js"),l=()=>"../../../components/VerificationCode.js";if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+l+e.resolveComponent("uni-forms")+e.resolveComponent("layout-default-uni"))()}Math||((()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-easyinput/uni-easyinput.js")+(()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-forms-item/uni-forms-item.js")+(()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-forms/uni-forms.js"))();const a=e.defineComponent({__name:"index",setup(l){const a=n.useUserStore(),s=e.ref(!1),r=e.ref({mobile:"",code:"",type:"bind"}),t=e.ref(),d={mobile:{rules:[{required:!0,errorMessage:"请输入手机号"}]},code:{rules:[{required:!0,errorMessage:"请输入验证码"}]}},m=async()=>{await t.value.validate(),await o.apiPostBindMobile({...r.value}),await a.getUser(),e.index.navigateBack()},c=async()=>{if(!r.value.mobile)return u.useToast("请输入手机号");s.value=!0,await o.apiPostSendCode({mobile:r.value.mobile,scene:"bind"===r.value.type?i.CodeTypeEnum.BIND_MOBILE:i.CodeTypeEnum.CHANGE_MOBILE}),console.log("发送获取验证码请求")};return e.onMounted((()=>{var o,i,n;r.value.mobile=(null==(o=a.userInfo)?void 0:o.mobile)||"",r.value.type=(null==(i=a.userInfo)?void 0:i.mobile)?"change":"bind",e.index.setNavigationBarTitle({title:(null==(n=a.userInfo)?void 0:n.mobile)?"更换手机号":"绑定手机号"})})),(o,i)=>({a:e.o((e=>r.value.mobile=e)),b:e.p({placeholder:"请输入手机号","prefix-icon":"person",modelValue:r.value.mobile}),c:e.p({label:"",name:"mobile"}),d:e.o(c),e:e.o((e=>s.value=e)),f:e.p({second:59,"countdown-switch":s.value}),g:e.o((e=>r.value.code=e)),h:e.p({placeholder:"请输入验证码","prefix-icon":"email",modelValue:r.value.code}),i:e.p({label:"",name:"code"}),j:e.sr(t,"c3a8a04e-1,c3a8a04e-0",{k:"formRef"}),k:e.p({"model-value":r.value,rules:d}),l:e.o(m)})}});wx.createPage(a);
