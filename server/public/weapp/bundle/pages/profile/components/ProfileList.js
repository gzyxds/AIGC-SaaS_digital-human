"use strict";const e=require("../../../../common/vendor.js"),s=require("../../../../common/assets.js"),a=require("../../../../api/avatar.js"),t=require("../../../../composables/usePollingTask.js"),o=require("../../../../composables/useRequest.js"),i=require("../../../../enums/variableEnum.js"),l=require("../../../../utils/check.js"),n=()=>"../../../../components/ActionSheet.js";if(!Array){((()=>"../../../../components/ProductCard.js")+(()=>"../../../../components/EmptyStatus.js")+e.resolveComponent("z-paging")+n)()}Math;const r=e.defineComponent({__name:"ProfileList",setup(n){const r=e.ref(),u=e.ref(),c=e.ref(),d=e.ref(),p=e.ref();let v;const g=e.shallowRef(null),m=e.ref([]),f=async(e,s)=>{try{const{lists:t}=await a.apiGetAvatarVideoList({page_no:e,page_size:s});g.value.complete(t);const o=m.value.filter((e=>l.isTaskPendding(e.status))).length;v&&v(),o&&h(e*s)}catch(t){console.log("报错=>",t),g.value.complete(!1)}},h=async s=>{console.log("开始轮询");const{start:o,clear:i}=t.usePollingTask((async t=>{const{lists:o}=await a.apiGetAvatarVideoList({page_no:1,page_size:s});o.forEach(((s,a)=>{l.isTaskPendding(m.value[a].status)&&!e.isEqual(s.status,m.value[a].status)&&(m.value[a]=s)}));0===o.filter((e=>l.isTaskPendding(e.status))).length&&t()}));v=i,o()},k=()=>{e.index.navigateTo({url:"/pages/create_profile/index"})},_=async()=>{await a.apiPostAvatarVideoDelete({id:u.value}),g.value.refresh()},j=()=>{e.index.navigateTo({url:`/pages/digital_people/index?profileId=${u.value}&profileImage=${c.value}`})},y=()=>{const s=o.useDownloadFile({type:"video",fileUrl:d.value,success:e=>{console.log(e)},fail:e=>{console.log(e)}});null==s||s.onProgressUpdate((s=>{e.index.showLoading({title:`下载进度：${s.progress}%`,mask:!0}),console.log("下载进度：",`${s.progress}%`),100===s.progress&&e.index.hideLoading()}))};return e.onBeforeUnmount((()=>{v&&v()})),(a,t)=>({a:e.f(m.value,((s,a,t)=>({a:e.t(s.name),b:e.o((e=>{return a=s.id,t=s.cover,o=s.video_url,i=s.status,u.value=a,c.value=t,d.value=o,p.value=i,void r.value.open();var a,t,o,i}),s.id),c:s.id,d:"93d62002-1-"+t+",93d62002-0",e:e.p({images:s.cover,time:s.duration,url:s.video_url,status:s.status})}))),b:s._imports_2$2,c:e.o(k),d:e.p({"button-text":"创建形象"}),e:e.sr(g,"93d62002-0",{k:"paging"}),f:e.o(f),g:e.o((e=>m.value=e)),h:e.p({fixed:!1,height:"100%",modelValue:m.value}),i:e.sr(r,"93d62002-3",{k:"actionSheetRef"}),j:e.p({actions:[{title:"使用形象",type:"primary",show:Number(p.value)===Number(e.unref(i.TaskStatusEnum).SUCCESS),click:j},{title:"下载",show:Number(p.value)===Number(e.unref(i.TaskStatusEnum).SUCCESS),click:y},{title:"删除",type:"danger",click:_}]})})}});wx.createComponent(r);
