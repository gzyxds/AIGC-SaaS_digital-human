"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../common/assets.js"),t=require("../../../../api/audio.js"),u=require("../../../../composables/useAudio.js"),s=require("../../../../enums/variableEnum.js"),i=require("../../../../utils/helper.js"),n=require("../../../../utils/check.js"),o=require("../../../../composables/usePollingTask.js"),l=require("../../../../composables/useToast.js"),r=()=>"../../../../components/ActionSheet.js";if(!Array){((()=>"../../../../components/EmptyStatus.js")+e.resolveComponent("z-paging")+r)()}Math;const p=e.defineComponent({__name:"SoundList",props:{type:{type:Number}},setup(r){const p=r,{play:m,pause:c,stop:d,isPlaying:v}=u.useAudio(),f=e.ref(),g=e.ref(),b=e.ref(),y=e.ref(),S=e.ref(),T=e.ref(),_=e.shallowRef(null),E=e.ref([]);let k;const N=async(e,a)=>{try{if(p.type===s.ProfileTabEnum.MySound){const{lists:u}=await t.apiGetVoiceList({page_no:e,page_size:a});_.value.complete(u);const s=E.value.filter((e=>n.isTaskPendding(e.status))).length;k&&k(),s&&h(e*a)}else{const{lists:u}=await t.apiGetCloneVoiceList({page_no:e,page_size:a});_.value.complete(u),console.log("page_no * page_size",e*a);const s=E.value.filter((e=>n.isTaskPendding(e.status))).length;k&&k(),s&&h(e*a)}}catch(u){console.log("报错=>",u),_.value.complete(!1)}},h=async a=>{console.log("开始轮询");const{start:u,clear:i}=o.usePollingTask((async u=>{let i=[];if(p.type===s.ProfileTabEnum.MySound){i=(await t.apiGetVoiceList({page_no:1,page_size:a})).lists}else{i=(await t.apiGetCloneVoiceList({page_no:1,page_size:a})).lists}i.forEach(((a,t)=>{n.isTaskPendding(E.value[t].status)&&!e.isEqual(a.status,E.value[t].status)&&(E.value[t]=a)}));0===i.filter((e=>n.isTaskPendding(e.status))).length&&u()}));k=i,u()},P=()=>{e.index.navigateTo({url:"/pages/create_sound/index"})},j=async()=>{p.type===s.ProfileTabEnum.MySound?await t.apiPostVoiceDelete({id:g.value}):await t.apiPostCloneVoiceDelete({id:g.value}),_.value.refresh()},C=()=>{e.index.navigateTo({url:`/pages/digital_people/index?soundId=${g.value}&soundName=${b.value}`})},w=async()=>{if(!y.value)return l.useToast("暂无下载链接",{duration:3e3});await i.useCopy(y.value),l.useToast("已经复制音频链接，请到浏览器下载",{duration:3e3})};return e.onBeforeUnmount((()=>{k&&k()})),(t,u)=>({a:e.f(E.value,((t,u,i)=>e.e({a:e.unref(v)&&f.value===t.id},e.unref(v)&&f.value===t.id?{b:a._imports_0$3,c:e.o(((...a)=>e.unref(c)&&e.unref(c)(...a)),t.id)}:e.e({d:a._imports_1$2,e:Number(t.status)===Number(e.unref(s.TaskStatusEnum).FAIL)},(Number(t.status),Number(e.unref(s.TaskStatusEnum).FAIL),{}),{f:Number(t.status)===Number(e.unref(s.TaskStatusEnum).PENDDING)},(Number(t.status),Number(e.unref(s.TaskStatusEnum).PENDDING),{}),{g:e.o((e=>{return a=t.id,u=t.voice_url,i=t.status,void(Number(i)===Number(s.TaskStatusEnum.SUCCESS)&&(f.value&&f.value!==a?(f.value=a,d(),m(u)):(f.value=a,m(u))));var a,u,i}),t.id)}),{h:e.t(r.type===e.unref(s.ProfileTabEnum).MySound?null==t?void 0:t.name:null==t?void 0:t.title),i:e.t(null==t?void 0:t.create_time),j:e.o((e=>{return a=t.id,u=(null==t?void 0:t.name)||"",s=null==t?void 0:t.voice_url,i=null==t?void 0:t.status,g.value=a,b.value=u,y.value=s,S.value=i,void T.value.open();var a,u,s,i}),t.id),k:t.id}))),b:a._imports_2$2,c:e.o(P),d:e.p({"button-text":"创建声音","show-button":r.type===e.unref(s.ProfileTabEnum).MySound}),e:e.sr(_,"2ea3ad36-0",{k:"paging"}),f:e.o(N),g:e.o((e=>E.value=e)),h:e.p({fixed:!1,height:"100%",modelValue:E.value}),i:e.sr(T,"2ea3ad36-2",{k:"actionSheetRef"}),j:e.p({actions:[{title:"使用声音",type:"primary",show:p.type===e.unref(s.ProfileTabEnum).MySound&&Number(S.value)===Number(e.unref(s.TaskStatusEnum).SUCCESS),click:C},{title:"下载",click:w,show:Number(S.value)===Number(e.unref(s.TaskStatusEnum).SUCCESS)},{title:"删除",type:"danger",click:j}]})})}});wx.createComponent(p);
