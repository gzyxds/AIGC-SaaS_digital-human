"use strict";const e=require("../../../common/vendor.js"),r=require("../../../common/assets.js"),o=require("../../../api/common.js"),n=require("../../../api/pay.js"),i=require("../../../api/power.js"),t=require("../../../enums/variableEnum.js"),a=require("../../../stores/user.js"),u=require("../../../composables/useToast.js");if(!Array){(e.resolveComponent("mp-html")+e.resolveComponent("uv-qrcode")+e.resolveComponent("uni-popup")+e.resolveComponent("layout-default-uni"))()}Math||((()=>"../../../uni_modules/mp-html/components/mp-html/mp-html.js")+(()=>"../../../uni_modules/uv-qrcode/components/uv-qrcode/uv-qrcode.js")+(()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup.js"))();const s=e.defineComponent({__name:"index",setup(s){const d=a.useUserStore(),{getList:p,list:l}=i.apiGetPowerPlanList(),c=e.ref(),m=e.ref(0),v=e.computed((()=>{var e;return(null==(e=l.value.find((e=>e.id===m.value)))?void 0:e.cost)||""})),b=e.ref("111"),f=e.ref(),g=()=>{e.index.navigateTo({url:`/bundle/pages/agreement/index?type=${t.AgreementTypeEnum.RECHARGE}`})},_=e.debounce((async()=>{var r;const o=await n.apiPostRecharge({package:m.value});let i="";if(!(null==(r=d.userInfo)?void 0:r.is_auth)){i=(await e.index.login({provider:"weixin"})).code}const t=await n.apiPostPrePay({from:"recharge",order_id:o.order_id,pay_way:"2",code:i});e.index.requestPayment({provider:"wxpay",...t.config,success(){u.useToast().success("支付成功"),d.getUser(),setTimeout((()=>{e.index.navigateTo({url:"/bundle/pages/hashrate_log/index"})}),500)},fail(){u.useToast().error("支付失败")}})}),500);return e.onBeforeUnmount((()=>{})),e.onMounted((async()=>{var e;await p(),m.value=null==(e=l.value[0])?void 0:e.id;const r=await o.apiGetPolicy(t.AgreementTypeEnum.CURRENCY);c.value=r})),(o,n)=>{var i,t;return{a:r._imports_0$2,b:e.f(e.unref(l),((r,o,n)=>({a:e.t(r.title),b:e.t(r.power),c:e.t(r.cost),d:e.t(r.original_cost),e:e.n(r.id===e.unref(m)?"bg-primary":"bg-_a_52525F"),f:e.t(r.gift_power),g:e.n(r.id===e.unref(m)?"bg-primary":"bg-_a_52525F"),h:e.n(r.id===e.unref(m)?"border-primary":"border-_a_52525F"),i:e.o((e=>{return o=r.id,void(m.value=o);var o}),r.id),j:r.id}))),c:r._imports_1$3,d:r._imports_1$3,e:e.t(null==(i=e.unref(c))?void 0:i.title),f:e.p({content:null==(t=e.unref(c))?void 0:t.content}),g:e.t(e.unref(v)),h:e.o(((...r)=>e.unref(_)&&e.unref(_)(...r))),i:e.o(g),j:e.o((r=>{var o;return null==(o=e.unref(f))?void 0:o.close()})),k:e.sr("qrcode","9e3bb63b-3,9e3bb63b-2"),l:e.p({"canvas-id":"qrcode",value:e.unref(b),optional:{margin:10}}),m:e.t(e.unref(v)),n:e.sr(f,"9e3bb63b-2,9e3bb63b-0",{k:"payPopupRef"}),o:e.p({type:"center",animation:!0,"mask-background-color":"rgba(0, 0, 0, 0.7)","border-radius":"1rem","background-color":"#292929","is-mask-click":!1})}}}}),d=e._export_sfc(s,[["__scopeId","data-v-9e3bb63b"]]);wx.createPage(d);
