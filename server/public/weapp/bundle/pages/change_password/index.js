"use strict";const e=require("../../../common/vendor.js"),o=require("../../../api/user.js"),s=require("../../../stores/user.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-forms")+e.resolveComponent("layout-default-uni"))()}Math||((()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-easyinput/uni-easyinput.js")+(()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-forms-item/uni-forms-item.js")+(()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-forms/uni-forms.js"))();const r=e.defineComponent({__name:"index",setup(r){const a=s.useUserStore(),d=e.ref({password:"",password_confirm:"",old_password:""}),u=e.ref(),i={password:{rules:[{required:!0,errorMessage:"请输入新密码"}]},password_confirm:{rules:[{required:!0,errorMessage:"请确认新密码"}]},old_password:{rules:[{required:!0,errorMessage:"请输入原密码"}]}},l=async()=>{var s;await u.value.validate(),d.value.password===d.value.password_confirm?((null==(s=a.userInfo)?void 0:s.has_password)?await o.apiPostChangePassword(d.value):await o.apiPostSetPassword(d.value),a.logout(),setTimeout((()=>{e.index.switchTab({url:"/pages/user/index"})}),500)):e.index.showToast({title:"两次输入的密码不一致",icon:"error"})};return e.onMounted((()=>{var o;e.index.setNavigationBarTitle({title:(null==(o=a.userInfo)?void 0:o.has_password)?"修改密码":"设置密码"})})),(o,s)=>{var r,n;return e.e({a:e.o((e=>d.value.password=e)),b:e.p({type:"password",placeholder:"请输入新密码","prefix-icon":"locked",modelValue:d.value.password}),c:e.p({label:"",name:"password"}),d:e.o((e=>d.value.password_confirm=e)),e:e.p({type:"password",placeholder:"请确认新密码","prefix-icon":"locked",modelValue:d.value.password_confirm}),f:e.p({label:"",name:"confirmPassword"}),g:null==(r=e.unref(a).userInfo)?void 0:r.has_password},(null==(n=e.unref(a).userInfo)?void 0:n.has_password)?{h:e.o((e=>d.value.old_password=e)),i:e.p({type:"password",placeholder:"请输入原密码","prefix-icon":"locked",modelValue:d.value.old_password}),j:e.p({label:"",name:"oldPassword"})}:{},{k:e.sr(u,"233d80dc-1,233d80dc-0",{k:"formRef"}),l:e.p({"model-value":d.value,rules:i}),m:e.o(l)})}}});wx.createPage(r);
