"use strict";const e=require("./common/vendor.js"),s=require("./common/assets.js"),a=require("./api/avatar.js"),t=require("./enums/variableEnum.js"),o=require("./utils/check.js"),i=require("./composables/usePollingTask.js"),l=require("./composables/useToast.js"),n=require("./composables/useRequest.js"),r=()=>"./components/ActionSheet.js";if(!Array){((()=>"./components/ProductCard.js")+(()=>"./components/EmptyStatus.js")+e.resolveComponent("z-paging")+r+e.resolveComponent("layout-default-uni"))()}Math;const u=e.defineComponent({__name:"ProductList",props:{type:{}},setup(r){const u=r,c=e.ref(),p=e.ref(),d=e.ref(),g=e.ref(),v=e.shallowRef(null),m=e.ref([]);let f;const h=async(e,s)=>{try{const{lists:t}=await a.apiGetAiAvatarList({page_no:e,page_size:s,status:u.type});v.value.complete(t);const i=m.value.filter((e=>o.isTaskPendding(e.status))).length;f&&f(),i&&_(e*s)}catch(t){console.log("报错=>",t),v.value.complete(!1)}},_=async s=>{console.log("开始轮询");const{start:t,clear:l}=i.usePollingTask((async t=>{const{lists:i}=await a.apiGetAiAvatarList({page_no:1,page_size:s,status:u.type});i.forEach(((s,a)=>{o.isTaskPendding(m.value[a].status)&&!e.isEqual(s.status,m.value[a].status)&&(m.value[a]=s)}));0===i.filter((e=>o.isTaskPendding(e.status))).length&&t()}));f=l,t()},y=async()=>{await a.apiPostAiAvatarDelete({id:p.value}),l.useToast("删除成功"),v.value.refresh()},k=()=>{const s=n.useDownloadFile({type:"video",fileUrl:d.value,success:e=>{console.log("保存成功",e)},fail:e=>{console.log("保存失败",e)}});null==s||s.onProgressUpdate((s=>{e.index.showLoading({title:`下载进度：${s.progress}%`,mask:!0}),console.log("下载进度：",`${s.progress}%`),100===s.progress&&e.index.hideLoading()}))};const j=()=>{e.index.navigateTo({url:"/pages/digital_people/index"})};return e.onShow((()=>{e.nextTick$1((()=>{var e;null==(e=v.value)||e.refresh()}))})),e.onBeforeUnmount((()=>{f&&f()})),(a,o)=>({a:e.f(m.value,((s,a,t)=>({a:e.t(s.title),b:e.t(null==s?void 0:s.voice_name),c:e.o((e=>{return a=s.id,t=s.resultFile,o=s.status,p.value=a,d.value=t,g.value=o,void c.value.open();var a,t,o}),s.id),d:s.id,e:"57c7aa04-2-"+t+",57c7aa04-1",f:e.p({images:s.cover,time:s.duration,url:s.resultFile,status:s.status,"fail-reason":s.fail_reason})}))),b:s._imports_1$2,c:s._imports_2$2,d:e.o(j),e:e.p({"button-text":"创建数字人"}),f:e.sr(v,"57c7aa04-1,57c7aa04-0",{k:"paging"}),g:e.o(h),h:e.o((e=>m.value=e)),i:e.p({fixed:!1,height:"100%",modelValue:m.value}),j:e.sr(c,"57c7aa04-4,57c7aa04-0",{k:"actionSheetRef"}),k:e.p({actions:[{title:"下载",type:"primary",show:Number(g.value)===Number(e.unref(t.TaskStatusEnum).SUCCESS),click:k},{title:"删除",type:"danger",click:y}]})})}}),c=e._export_sfc(u,[["__scopeId","data-v-57c7aa04"]]);exports.MiniProgramPage=c;
