import{aI as e,a4 as t,q as r,bb as n,af as o,bc as a,v as i,at as u,au as c,x as l,aT as s,ay as f}from"./index-CTSv8bdf.js";function h(){let e=[];return{add:function(t){return e.push(t),()=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)}},list:()=>e,reset:function(){e=[]}}}const p=/#/g,v=/&/g,d=/\+/g,g=/%5B/g,y=/%5D/g,m=/%5E/g,b=/%60/g,P=/%7B/g,R=/%7C/g,$=/%7D/g,w=/%20/g;function O(e){return function(e){return encodeURI(`${e}`).replace(R,"|").replace(g,"[").replace(y,"]")}(e).replace(d,"%2B").replace(w,"+").replace(p,"%23").replace(v,"%26").replace(b,"`").replace(P,"{").replace($,"}").replace(m,"^")}function j(e){try{return decodeURIComponent(`${e}`)}catch(t){q(`Error decoding "${e}". Using original value`)}return`${e}`}function q(e,t=!1,...r){t&&console.warn(`[uni-router warn]: ${e}`,...r)}const T=Symbol("navigation failure"),B={1:({location:e})=>`Navigation ${"string"==typeof e?e:JSON.stringify(e)} is not found`,2:({from:e,to:t})=>`Redirected from "${JSON.stringify(e)}" to "${JSON.stringify(t)}" via a navigation guard.`,4:({from:e,to:t})=>`Navigation aborted from "${JSON.stringify(e)}" to "${JSON.stringify(t)}" via a navigation guard.`,8:({from:e,to:t})=>`Navigation cancelled from "${JSON.stringify(e)}" to "${JSON.stringify(t)}" with a new navigation.`,16:({from:e,to:t})=>`Avoided redundant navigation to current location: "${JSON.stringify(e)}".`};function E(e,t){return e instanceof Error&&T in e&&!!(e.type&t)}function x(e,t){return Object.assign(new Error(B[e](t)),{type:e,[T]:!0},t)}const k=Array.isArray,G=e=>"string"==typeof e,S=/(^mp-weixin$)|(^mp-baidu$)|(^mp-alipay$)|(^mp-toutiao$)|(^mp-qq$)|(^mp-360$)/g,N=["navigateTo","redirectTo","reLaunch","switchTab","navigateBack"];var Q,L;(L=Q||(Q={})).navigate="navigateTo",L.redirect="redirectTo",L.reLaunch="reLaunch",L.switchTab="switchTab",L.navigateBack="navigateBack";const J={path:"/",name:"",query:{},fullPath:"/",meta:{}},A=Symbol(),I=Symbol(),M={navigateTo:i,redirectTo:u,reLaunch:c,switchTab:l,navigateBack:s};function _(e){const t={};if(""===e||"?"===e)return t;const r=("?"===e[0]?e.slice(1):e).split("&");for(let n=0;n<r.length;++n){const e=r[n].replace("+"," "),o=e.indexOf("="),a=j(o<0?e:e.slice(0,o)),i=o<0?null:j(e.slice(o+1));t[a]=i}return t}function C(e){for(const t in e){const r=e[t];null!=r&&(e[t]=j(r))}return e}function D(e){let t="";for(let r in e){const n=e[r];r=O(r),null!=n?void 0!==n&&(t+=(t.length?"&":"")+r,null!=n&&(t+=`=${O(n)}`)):void 0!==n&&(t+=(t.length?"&":"")+r)}return t}function U(e,t,r="/"){if("*"===t)return{path:t,query:{}};let n,o={},a="";const i=t.indexOf("?");return i>-1?(n=t.slice(0,i),a=t.slice(i+1),o=e(a)):n=t,n=function(e,t){if(e.startsWith("/"))return e;if(!t.startsWith("/"))return e;if(!e)return t;const r=t.split("/"),n=e.split("/"),o=n[n.length-1];".."!==o&&"."!==o||n.push("");let a,i,u=r.length-1;for(a=0;a<n.length;a++)if(i=n[a],"."!==i){if(".."!==i)break;u>1&&u--}return`${r.slice(0,u).join("/")}/${n.slice(a-(a===n.length?1:0)).join("/")}`}(null!=n?n:t,r),{path:n,query:o}}function W(e,t){const r=t.query?e(t.query):"";return t.path+(r&&"?")+r}function z(e){const t=new Map,r=new Map,n=new Map;return e.routes.forEach((o=>function(o){let{path:a,aliasPath:i,name:u}=o;const c=JSON.stringify(o);null!=a&&void 0!==a||q(`当前路由对象route：${c}不规范，必须含有\`path\``,e.debug),0!==a.indexOf("/")&&"*"!==a&&q(`当前路由对象route：${c} \`path\`缺少前缀 ‘/’`,e.debug),i=i||a,r.set(a,o),t.set(i,o),u&&(n.has(u)&&q(`当前路由对象route：${c} 的\`name\`已存在路由表中，将会覆盖旧值`,e.debug),n.set(u,o))}(o))),{getRouteByAliasPath:function(e){return t.get(e)},getRouteByPath:function(e){return r.get(e)},getRouteByName:function(e){return n.get(e)}}}function F(e,t){var r;let{fullPath:n,path:o,name:a,query:i,meta:u}=t;const{getRouteByAliasPath:c,getRouteByPath:l}=e.routeMatcher,s=Object.assign({},J);if("h5"===e.options.platform){const s="/"===o?c(o):l(o);i=t.query=C(null===(r=U(e.parseQuery,n))||void 0===r?void 0:r.query),n=W(e.stringifyQuery,t),u=Object.assign({},null==s?void 0:s.meta,u),a=null==s?void 0:s.name}return s.fullPath=n,s.meta=u,s.path=o,s.name=a,s.query=i,s}function H(e){return"string"==typeof e||e&&"object"==typeof e}function K(e,t){return!(!e.fullPath&&!t.fullPath)&&e.fullPath===t.fullPath}function V(e,t){const r=e.resolve("*");if(!r||void 0===r.redirect)throw q("未匹配到*通配符路径，或者*通配符必须配合 redirect 使用。redirect: string | Location",e.options.debug),x(1,{location:t});let n;n="function"==typeof r.redirect?r.redirect(t):r.redirect;if(void 0===e.resolve(n))throw q(`无法解析解析出redirect：${JSON.stringify(n)}中的内容，`,e.options.debug),x(1,{location:t});return x(2,{to:n,from:t})}function X(e){return e.reduce(((e,t)=>e.then((()=>t()))),Promise.resolve())}function Y(e,t,r){return()=>new Promise(((n,o)=>{const a=e=>{!1===e?o(x(4,{to:t,from:r})):e instanceof Error?o(e):H(e)?o(x(2,{to:e,from:t})):n()},i=e(t,r,a);let u=Promise.resolve(i);"object"==typeof i&&"then"in i?u=u.then(a):void 0!==i&&a(i),u.catch((e=>o(e)))}))}function Z(e,t){let r=e.$scope.route;r=r.startsWith("/")?r:`/${r}`;return{path:r,query:e.$scope.options||{}}}function ee(e,t,r,n){return(...o)=>{t.call(r,o,(t=>{e.apply(r,t)}),n)}}const te={onLoad([e],t,r){t([C(e)])},onShow(e,t,r){console.log(e);const n=o().length;let a,i;if(r.fromRoute)a=r.currentRoute.value,i=r.fromRoute,r.fromRoute=void 0;else{const n=Z(this);if(a=F(r,r.resolve(n)),i=r.currentRoute.value,K(a,i))return t(e);r.currentRoute.value=a}const u=[];for(const o of r.guards.afterGuards.list())u.push((()=>{return e=this,t=null,r=function*(){o(a,i)},new Promise(((n,o)=>{var a=e=>{try{u(r.next(e))}catch(t){o(t)}},i=e=>{try{u(r.throw(e))}catch(t){o(t)}},u=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,i);u((r=r.apply(e,t)).next())}));var e,t,r}));X(u),r.level=n,t(e)}};function re(e,t){return{path:e.$page.path,query:e.$page.options||{}}}const ne={onShow(e){const t=o().length;let r,n;if(e.fromRoute)r=e.currentRoute.value,n=e.fromRoute,e.fromRoute=void 0;else{const t=re(this);if(r=F(e,e.resolve(t)),n=e.currentRoute.value,K(r,n))return;e.currentRoute.value=r}const a=[];for(const o of e.guards.afterGuards.list())a.push((()=>{return e=this,t=null,a=function*(){o(r,n)},new Promise(((r,n)=>{var o=e=>{try{u(a.next(e))}catch(t){n(t)}},i=e=>{try{u(a.throw(e))}catch(t){n(t)}},u=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,i);u((a=a.apply(e,t)).next())}));var e,t,a}));X(a),e.level=t}};function oe(e,t){const r=function(e){let t=e.options.platform;S.test(t)&&(t="applets");const r={app:{beforeCreate(){"page"===this.$mpType&&function(e,t){if(ne&&e.$)for(const r in ne){const n=ne[r],o=e.$[r];k(o)?o.unshift(n.bind(e,t)):e.$[r]=[n.bind(e,t)]}}(this,e)}},h5:{},applets:{beforeCreate(){"page"===this.$mpType&&function(e,t){if(console.log(e),te&&e.$scope)for(const r in te){const n=te[r],o=e.$scope[r];o&&(e.$scope[r]=ee(o,n,e,t))}}(this,e)}}};return r[t]||{}}(t);e.mixin(r)}function ae(e,t,r){var n;const o={beforeGuards:()=>{var t;null===(t=e.vueRouter)||void 0===t||t.beforeEach(((t,n,o)=>{const a=e.resolve(t),i=F(e,t),u=F(e,n);let c;void 0===a&&(c=V(e,i));const l=t=>{if(!H(t)||t instanceof Error)o(t);else if(G(t)||!t.navType){const r=e.resolve(t);r&&o({path:r.path,query:r.query})}else{const r=t.navType;e.navigate(t,r)}};if(E(c,2))return void e.redirectTo(null==c?void 0:c.to);const s=r(i,u,l);"object"==typeof s&&"then"in s?s.then(l).catch((()=>{l(!1)})):void 0!==s&&l(s)}))},afterGuards:()=>{var t;null===(t=e.vueRouter)||void 0===t||t.afterEach(((t,n)=>{const o=F(e,t),a=F(e,n);r(o,a)}))}};null===(n=o[t])||void 0===n||n.call(o)}var ie=Object.defineProperty,ue=Object.defineProperties,ce=Object.getOwnPropertyDescriptors,le=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable,he=(e,t,r)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pe=(e,t)=>{for(var r in t||(t={}))se.call(t,r)&&he(e,r,t[r]);if(le)for(var r of le(t))fe.call(t,r)&&he(e,r,t[r]);return e},ve=(e,t)=>ue(e,ce(t));var de={resolve:function(e,t,r="navigateTo"){const{getRouteByName:n,getRouteByPath:o,getRouteByAliasPath:a}=e.routeMatcher;if(G(t)&&(t={path:t}),Reflect.has(t,"delta")&&"navigateBack"===r||"backbutton"===t.from)return t;Reflect.has(t,"url")&&(t=ve(pe({},t),{path:t.url}));const i=e.currentRoute.value.path,u="/"===i?a(i):o(i);if(Reflect.has(t,"path")){const r=U(e.parseQuery,t.path,null==u?void 0:u.path);let n=o(r.path);if(void 0===n&&(n=a(r.path)),void 0===n)return;const i=Object.assign({},r.query,null==t?void 0:t.query),c=W(e.stringifyQuery,{path:n.path,query:i});return ve(pe({},t),{path:n.path,meta:n.meta||{},name:n.name,redirect:n.redirect,fullPath:c,query:i})}if(Reflect.has(t,"name")){let r=n(t.name);if(void 0===r)return void(r=o("*"));const a=Object.assign({},t.query),i=W(e.stringifyQuery,{path:r.path,query:a});return ve(pe({},t),{path:r.path,meta:r.meta||{},name:r.name,redirect:r.redirect,fullPath:i,query:a})}},mount:function(e,t){!function(e,t){const{h5:r}=t.options,n=e.config.globalProperties.$router,o=n.options.scrollBehavior;Object.assign(n.options,r),n.options.scrollBehavior=function(e,t,n){return(null==r?void 0:r.scrollBehavior)?null==r?void 0:r.scrollBehavior(e,t,n):o(e,t,n)},t.vueRouter=n;for(const[a,i]of Object.entries(t.guards))i.list().forEach((e=>{ae(t,a,e)}));n.afterEach((e=>{t.currentRoute.value=F(t,e)}))}(e,t)},navigate:function(e,t,r="navigateTo",n){let i,u=e.resolve(t,r);void 0===u&&(i=V(e,t));const c=e.currentRoute.value,l=o();return"navigateBack"===r&&u.delta>=l.length&&(u=e.resolve("/","reLaunch"),r="reLaunch"),(i?Promise.resolve(i):e.jump(u,r)).catch((e=>E(e,2)?e:Promise.reject(e))).then((t=>{if(t){if(E(t,2)){const r=e.resolve(null==t?void 0:t.to);return u&&K(u,r)&&n&&(n._count=n._count?n._count+1:1)>30?(a(`检测到从“${c.fullPath}”到“${u.fullPath}”时导航守卫中可能存在无限重定向。中止以避免堆栈溢出。\n            是否总是在导航防护中返回新位置？这将导致此错误。仅在重定向或中止时返回，这应该可以解决此问题。如果未修复，这可能会在生产中中断`,e.options.debug),Promise.reject(new Error("Infinite redirect in navigation guard"))):e.navigate(r,r.navType,n||u)}return Promise.resolve(t)}}))},jump:function(e,t,r){return new Promise(((e,n)=>{M[r](ve(pe({},t),{url:t.fullPath,success(r){var n;e(r),null===(n=t.success)||void 0===n||n.call(t,r)},fail(e){var r;n(e),null===(r=t.fail)||void 0===r||r.call(t,e)},complete(e){var r;null===(r=t.complete)||void 0===r||r.call(t,e)}}))}))},forceGuardEach:function(e){return t=this,r=null,n=function*(){throw new Error("在h5端上使用：forceGuardEach 是无意义的，目前 forceGuardEach 仅支持在非h5端上使用")},new Promise(((e,o)=>{var a=e=>{try{u(n.next(e))}catch(t){o(t)}},i=e=>{try{u(n.throw(e))}catch(t){o(t)}},u=t=>t.done?e(t.value):Promise.resolve(t.value).then(a,i);u((n=n.apply(t,r)).next())}));var t,r,n}},ge=Object.defineProperty,ye=Object.defineProperties,me=Object.getOwnPropertyDescriptors,be=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,$e=(e,t,r)=>t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,we=(e,t)=>{for(var r in t||(t={}))Pe.call(t,r)&&$e(e,r,t[r]);if(be)for(var r of be(t))Re.call(t,r)&&$e(e,r,t[r]);return e},Oe=(e,t)=>ye(e,me(t)),je=(e,t,r)=>new Promise(((n,o)=>{var a=e=>{try{u(r.next(e))}catch(t){o(t)}},i=e=>{try{u(r.throw(e))}catch(t){o(t)}},u=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,i);u((r=r.apply(e,t)).next())}));var qe={resolve:function(e,t,r="navigateTo"){const{getRouteByName:n,getRouteByPath:a,getRouteByAliasPath:i}=e.routeMatcher;if(G(t)&&(t={path:t}),Reflect.has(t,"delta")&&"navigateBack"===r||"backbutton"===t.from){t.delta=t.delta||1;const r=o();let n,a=0;r.length>t.delta&&(a=r.length-1-t.delta),n="app"===e.options.platform?re(r[a]):Z(r[a].$vm),t=Oe(we(we({},n),t),{force:"backbutton"===t.from})}Reflect.has(t,"url")&&(t=Oe(we({},t),{path:t.url}));const u=e.currentRoute.value.path,c="/"===u?i(u):a(u);if(Reflect.has(t,"path")){const r=U(e.parseQuery,t.path,null==c?void 0:c.path);let n=a(r.path);if(void 0===n&&(n=i(r.path)),void 0===n)return;const o=Object.assign({},r.query,null==t?void 0:t.query),u=W(e.stringifyQuery,{path:n.path,query:o});return Oe(we({},t),{path:n.path,meta:n.meta||{},name:n.name,redirect:n.redirect,fullPath:u,query:o})}if(Reflect.has(t,"name")){const r=n(t.name);if(void 0===r)return;const o=Object.assign({},t.query),a=W(e.stringifyQuery,{path:r.path,query:o});return Oe(we({},t),{path:r.path,meta:r.meta||{},name:r.name,redirect:r.redirect,fullPath:a,query:o})}},mount:function(e,t){t.forceGuardEach()},navigate:function(e,t,r="navigateTo",n){try{const o=e.resolve(t,r),a=null==o?void 0:o.force;if(e.lock&&!a)return Promise.resolve();e.lock=!0;const i=e.currentRoute.value;let u;if(void 0===o)u=V(e,t);else if(!a&&K(o,i)){u=x(16,{to:F(e,o),from:i})}return(u?Promise.resolve(u):e.jump(o,r)).catch((e=>E(e,2)?e:Promise.reject(e))).then((t=>{if(t){if(E(t,2)){const r=e.resolve(null==t?void 0:t.to);return o&&K(o,r)&&n&&(n._count=n._count?n._count+1:1)>30?(q(`检测到从“${i.fullPath}”到“${o.fullPath}”时导航守卫中可能存在无限重定向。中止以避免堆栈溢出。\n            是否总是在导航防护中返回新位置？这将导致此错误。仅在重定向或中止时返回，这应该可以解决此问题。如果未修复，这可能会在生产中中断`,e.options.debug),Promise.reject(new Error("Infinite redirect in navigation guard"))):(e.lock=!1,e.navigate(r,r.navType,n||o))}return Promise.resolve(t)}})).finally((()=>{e.lock=!1}))}catch(o){return e.lock=!1,Promise.reject(o)}},jump:function(e,t,r){return new Promise(((n,o)=>{const a=F(e,t);Promise.resolve().then((()=>{const t=[];for(const r of e.guards.beforeGuards.list())t.push(Y(r,a,e.currentRoute.value));return X(t)})).then((()=>{e.fromRoute=e.currentRoute.value,e.currentRoute.value=a,M[r](Oe(we({},t),{url:t.fullPath,success(e){var r;null===(r=t.success)||void 0===r||r.call(t,e),n(e)},fail(e){var r;null===(r=t.fail)||void 0===r||r.call(t,e),o(e)},complete(e){var r;null===(r=t.complete)||void 0===r||r.call(t,e)}}))})).catch(o)}))},forceGuardEach:function(e){return je(this,null,(function*(){const t=function(){const e=f();return{path:`/${e.path}`,query:e.query||{}}}(),r=e.resolve(t);let n;if(void 0===r)n=V(e,t);else{const t=F(e,r),a=[];for(const r of e.guards.beforeGuards.list())a.push(Y(r,t,J));try{yield X(a),e.currentRoute.value=t;const r=[];for(const n of e.guards.afterGuards.list())r.push((()=>je(this,null,(function*(){n(t,J)}))));yield X(r)}catch(o){n=o}}if(E(n,2))return e.reLaunch(null==n?void 0:n.to)}))}};function Te(o){const a={beforeGuards:h(),afterGuards:h()},i=e(J),u=z(o),c="h5"===o.platform?de:qe;function l(e,t="navigateTo",r){return new Promise(((n,o)=>{let a={};var i;null!=(i=e)&&"object"==typeof i&&(a=e),c.navigate(s,e,t,r).then((e=>{n(e)})).catch((e=>{var t,r;null===(t=a.fail)||void 0===t||t.call(a,e),null===(r=a.complete)||void 0===r||r.call(a,e),o(e)}))}))}const s={level:0,lock:!1,currentRoute:i,guards:a,options:o,vueRouter:null,routeMatcher:u,parseQuery:o.parseQuery||_,stringifyQuery:o.stringifyQuery||D,jump:function(e,t){return new Promise(((r,n)=>{c.jump(s,e,t).then(r).catch(n)}))},navigateTo:e=>l(e,"navigateTo"),switchTab:e=>l(e,"switchTab"),redirectTo:e=>l(e,"redirectTo"),reLaunch:e=>l(e,"reLaunch"),navigateBack:(e={delta:1})=>l(e,"navigateBack"),navigate:l,resolve:function(e,t="navigateTo"){return c.resolve(s,e,t)},forceGuardEach:function(){return new Promise(((e,t)=>{c.forceGuardEach(s).then(e).catch(t)}))},beforeEach(e){a.beforeGuards.add(e)},afterEach(e){a.afterGuards.add(e)},install(e){const o={};for(const r in J)o[r]=t((()=>i.value[r]));e.config.globalProperties.$uniRouter=s,Object.defineProperty(e.config.globalProperties,"$uniRoute",{enumerable:!0,get:()=>r(i)}),e.provide(A,s),e.provide(I,n(o));const a=e.mount;e.mount=function(...t){return function(e){N.forEach((t=>{uni[t]=function(r){return e[t](r)}}))}(s),c.mount(e,s),oe(e,s),console.log("%c uni-router %c v1.2.7 ","padding: 2px 1px; border-radius: 3px 0 0 3px; color: #fff; background: #606060; font-weight: bold;","padding: 2px 1px; border-radius: 0 3px 3px 0; color: #fff; background: #42c02e; font-weight: bold;"),a(...t)}}};return s}export{Te as c};
