import{_ as e}from"./FuiTabs.D8r9apAA.js";import{d as a,r as l,aI as t,k as s,G as o,J as u,o as r,c as n,w as i,a as p,n as c,p as d,F as f,q as m,v,R as g,ai as _,aj as y,i as x,b,t as h,aA as k,aE as w,e as S,a6 as C,s as N,h as j,l as z,_ as E}from"./index-CTSv8bdf.js";import{_ as M}from"./ActionSheet.DxV314ss.js";import{_ as U}from"./EmptyStatus.vue_vue_type_script_setup_true_lang.BbsBdioH.js";import{_ as P}from"./ProductCard.pVvRNm7o.js";import{_ as I}from"./z-paging.DcYRLe5r.js";import{_ as V}from"./icon-setting.BVTtbP7i.js";import{d as $,f as A}from"./avatar.D4ZfpDUd.js";import{u as F,i as D}from"./usePollingTask.4RHfPE49.js";import{i as H}from"./check.NUthcyNX.js";import{_ as L}from"./icon-sound-play.BP2LNVwo.js";import{_ as R}from"./icon-sound.D7rZqbzE.js";import{u as G,b as J,c as Q,d as T,e as q}from"./useAudio.-uo5Ft4D.js";import"./icon-star.CATSwGXR.js";import"./index.BEstvkTC.js";const K=a({__name:"ProfileList",setup(e){const a=l(),C=l(),N=l(),j=l(),z=l();let E;const L=t(null),R=l([]),G=async(e,a)=>{try{const{lists:l}=await $({page_no:e,page_size:a});L.value.complete(l);const t=R.value.filter((e=>H(e.status))).length;E&&E(),t&&J(e*a)}catch(l){console.log("报错=>",l),L.value.complete(!1)}},J=async e=>{console.log("开始轮询");const{start:a,clear:l}=F((async a=>{const{lists:l}=await $({page_no:1,page_size:e});l.forEach(((e,a)=>{H(R.value[a].status)&&!D(e.status,R.value[a].status)&&(R.value[a]=e)}));0===l.filter((e=>H(e.status))).length&&a()}));E=l,a()},Q=()=>{v({url:"/pages/create_profile/index"})},T=async()=>{await A({id:C.value}),L.value.refresh()},q=()=>{v({url:`/pages/digital_people/index?profileId=${C.value}&profileImage=${N.value}`})},K=()=>{const e=g({type:"video",fileUrl:j.value,success:e=>{console.log(e)},fail:e=>{console.log(e)}});null==e||e.onProgressUpdate((e=>{_({title:`下载进度：${e.progress}%`,mask:!0}),console.log("下载进度：",`${e.progress}%`),100===e.progress&&y()}))};return s((()=>{E&&E()})),(e,l)=>{const t=x,s=S,v=P,g=U,_=o(u("z-paging"),I),y=M;return r(),n(t,{class:"h-full"},{default:i((()=>[p(_,{ref_key:"paging",ref:L,modelValue:R.value,"onUpdate:modelValue":l[0]||(l[0]=e=>R.value=e),fixed:!1,height:"100%",onQuery:G},{empty:i((()=>[p(t,{"h-full":"","w-full":""},{default:i((()=>[p(g,{"button-text":"创建形象",onHandle:Q})])),_:1})])),default:i((()=>[p(t,{grid:"","grid-cols-2":"","gap-x-22rpx":""},{default:i((()=>[(r(!0),c(f,null,d(R.value,(e=>(r(),n(v,{key:e.id,images:e.cover,time:e.duration,url:e.video_url,status:e.status},{content:i((()=>[p(t,{between:"","pl-3.5":"","pr-2":"",text:"sm foreground"},{default:i((()=>[p(t,{text:"sm foreground","line-clamp-1":""},{default:i((()=>[b(h(e.name),1)])),_:2},1024),p(t,{class:"flex items-center justify-center rounded-[28rpx] bg-background-muted","min-h-56rpx":"","min-w-56rpx":"",onClick:k((l=>{return t=e.id,s=e.cover,o=e.video_url,u=e.status,C.value=t,N.value=s,j.value=o,z.value=u,void a.value.open();var t,s,o,u}),["stop"])},{default:i((()=>[p(s,{src:V,class:"h-[44rpx] w-[44rpx]"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["images","time","url","status"])))),128))])),_:1})])),_:1},8,["modelValue"]),p(y,{ref_key:"actionSheetRef",ref:a,actions:[{title:"使用形象",type:"primary",show:Number(z.value)===Number(m(w).SUCCESS),click:q},{title:"下载",show:Number(z.value)===Number(m(w).SUCCESS),click:K},{title:"删除",type:"danger",click:T}]},null,8,["actions"])])),_:1})}}}),O=a({__name:"SoundList",props:{type:{type:Number}},setup(e){const a=e,{play:g,pause:_,stop:y,isPlaying:j}=G(),z=l(),E=l(),P=l(),$=l(),A=l(),K=l(),O=t(null),B=l([]);let W;const X=async(e,l)=>{try{if(a.type===C.MySound){const{lists:a}=await J({page_no:e,page_size:l});O.value.complete(a);const t=B.value.filter((e=>H(e.status))).length;W&&W(),t&&Y(e*l)}else{const{lists:a}=await Q({page_no:e,page_size:l});O.value.complete(a),console.log("page_no * page_size",e*l);const t=B.value.filter((e=>H(e.status))).length;W&&W(),t&&Y(e*l)}}catch(t){console.log("报错=>",t),O.value.complete(!1)}},Y=async e=>{console.log("开始轮询");const{start:l,clear:t}=F((async l=>{let t=[];if(a.type===C.MySound){t=(await J({page_no:1,page_size:e})).lists}else{t=(await Q({page_no:1,page_size:e})).lists}t.forEach(((e,a)=>{H(B.value[a].status)&&!D(e.status,B.value[a].status)&&(B.value[a]=e)}));0===t.filter((e=>H(e.status))).length&&l()}));W=t,l()},Z=()=>{v({url:"/pages/create_sound/index"})},ee=async()=>{a.type===C.MySound?await T({id:E.value}):await q({id:E.value}),O.value.refresh()},ae=()=>{v({url:`/pages/digital_people/index?soundId=${E.value}&soundName=${P.value}`})},le=async()=>{console.log("下载")};return s((()=>{W&&W()})),(l,t)=>{const s=S,v=x,F=U,D=o(u("z-paging"),I),H=M;return r(),n(v,{class:"h-full"},{default:i((()=>[p(D,{ref_key:"paging",ref:O,modelValue:B.value,"onUpdate:modelValue":t[0]||(t[0]=e=>B.value=e),fixed:!1,height:"100%",onQuery:X},{empty:i((()=>[p(v,{"h-full":"","w-full":""},{default:i((()=>[p(F,{"button-text":"创建声音","show-button":e.type===m(C).MySound,onHandle:Z},null,8,["show-button"])])),_:1})])),default:i((()=>[(r(!0),c(f,null,d(B.value,(a=>(r(),n(v,{key:a.id,class:"mb-[24rpx] flex items-center justify-between rounded-[28rpx] px-[36rpx] py-[34rpx]","bg-background":""},{default:i((()=>[p(v,{class:"flex items-center"},{default:i((()=>[m(j)&&z.value===a.id?(r(),n(s,{key:0,src:L,class:"h-[80rpx] w-[80rpx] flex-none",onClick:m(_)},null,8,["onClick"])):(r(),n(v,{key:1,relative:"",onClick:e=>{return l=a.id,t=a.voice_url,s=a.status,void(Number(s)===Number(w.SUCCESS)&&(z.value&&z.value!==l?(z.value=l,y(),g(t)):(z.value=l,g(t))));var l,t,s}},{default:i((()=>[p(s,{src:R,class:"h-10 w-10 flex-none"}),Number(a.status)===Number(m(w).FAIL)?(r(),n(v,{key:0,position:"absolute left-0 top-0","h-10":"","w-10":"",center:"","rounded-full":"","text-base":"","font-600":"","backdrop-blur-sm":"",class:"bg-foreground/10"},{default:i((()=>[b(" 失败 ")])),_:1})):N("",!0),Number(a.status)===Number(m(w).PENDDING)?(r(),n(v,{key:1,position:"absolute left-0 top-0","h-10":"","w-10":"",center:"","rounded-full":"","text-base":"","backdrop-blur-sm":"",class:"bg-foreground/50"},{default:i((()=>[p(v,{"i-tabler:loader-2":"",class:"animate-spin text-primary"})])),_:1})):N("",!0)])),_:2},1032,["onClick"])),p(v,{class:"ml-[32rpx]"},{default:i((()=>[p(v,{text:"base foreground","line-clamp-1":"","mb-1.5":"","font-500":""},{default:i((()=>[b(h(e.type===m(C).MySound?null==a?void 0:a.name:null==a?void 0:a.title),1)])),_:2},1024),p(v,{text:"xs foreground-placeholder"},{default:i((()=>[b(h(null==a?void 0:a.create_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),p(v,{class:"rounded-[28rpx]","min-h-56rpx":"","min-w-56rpx":"",center:"","bg-background-muted":"",onClick:k((e=>{return l=a.id,t=(null==a?void 0:a.name)||"",s=null==a?void 0:a.voice_url,o=null==a?void 0:a.status,E.value=l,P.value=t,$.value=s,A.value=o,void K.value.open();var l,t,s,o}),["stop"])},{default:i((()=>[p(s,{src:V,class:"h-[44rpx] w-[44rpx]"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1},8,["modelValue"]),p(H,{ref_key:"actionSheetRef",ref:K,actions:[{title:"使用声音",type:"primary",show:a.type===m(C).MySound&&Number(A.value)===Number(m(w).SUCCESS),click:ae},{title:"下载",click:le,show:Number(A.value)===Number(m(w).SUCCESS)},{title:"删除",type:"danger",click:ee}]},null,8,["actions"])])),_:1})}}}),B=E(a({__name:"index",setup(a){const t=l(["我的形象","我的声音","声音合成"]),s=l(0),o=e=>{console.log("选中tabs => ",e),s.value=e.index};return j((e=>{console.log("options => ",e),e.type&&(s.value=Number(e.type))})),(a,l)=>{const u=e,c=x,d=z("layout-default-uni");return r(),n(d,null,{default:i((()=>[p(c,{class:"profile"},{default:i((()=>[p(u,{current:s.value,tabs:t.value,background:"#0d0d0d",color:"#ffffffb3","selected-color":"#ffffff","slider-background":"#1453e9","is-fixed":!0,onChange:o},null,8,["current","tabs"]),s.value===m(C).MyProfile?(r(),n(c,{key:0,class:"profile-list mt-[102rpx] px-[24rpx]"},{default:i((()=>[p(K)])),_:1})):N("",!0),s.value===m(C).MySound?(r(),n(c,{key:1,class:"profile-list mt-[102rpx] px-[24rpx]"},{default:i((()=>[p(O,{type:s.value},null,8,["type"])])),_:1})):N("",!0),s.value===m(C).SoundSynthesis?(r(),n(c,{key:2,class:"profile-list mt-[102rpx] px-[24rpx]"},{default:i((()=>[p(O,{type:s.value},null,8,["type"])])),_:1})):N("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-3d399f6d"]]);export{B as default};
