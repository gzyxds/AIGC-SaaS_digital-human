import{r as e,j as a,a1 as l,a2 as t,d as o,a3 as u,a4 as r,W as n,$ as d,a5 as s,h as i,G as c,J as f,l as p,o as g,c as m,w as v,v as x,a6 as _,N as b,X as y,Y as R,a as h,b as k,t as w,q as I,s as N,V as E,i as P,_ as D}from"./index-CTSv8bdf.js";import{u as C,a as S}from"./useAudio.-uo5Ft4D.js";import U from"./pages-create_sound-components-SoundPop.CTN9N7Xo.js";const j=D(o({__name:"index",setup(o){const D=e(),j=e(),A=e(u.INIT),{isRecording:M,audioFilePath:$,recordingDuration:G,startRecording:O,stopRecording:T,resetRecording:V,playRecording:F,pauseRecording:q,isPlaying:L}=function(){const o=e(!1),u=e(""),r=e(0);let n=null,d=[],s=null;const{play:i,pause:c,isPlaying:f}=C(),p=()=>{o.value&&(n&&n.stop(),s&&(clearInterval(s),s=null),o.value=!1)};return a((()=>{})),l((()=>{o.value&&p()})),{isRecording:o,audioFilePath:u,recordingDuration:r,startRecording:async()=>{if(!o.value){console.log("是否为微信小程序环境",t());{const e=await navigator.mediaDevices.getUserMedia({audio:!0});n=new MediaRecorder(e),n.ondataavailable=e=>{d.push(e.data)},n.onstop=()=>{const e=new Blob(d,{type:"audio/mp3"});u.value=URL.createObjectURL(e),d=[]},n.start()}s=setInterval((()=>{r.value+=1}),1e3),o.value=!0}},stopRecording:p,resetRecording:()=>{o.value&&p(),r.value=0,u.value=""},playRecording:()=>{u.value?(console.log("录音文件路径",u.value),i(u.value)):console.error("录音文件路径为空")},pauseRecording:()=>{f.value&&c()},isPlaying:f}}(),B=e({name:"",record:"",file_id:"",cover:"",duration:0,expected_content:"我的声音将用于平台克隆，并合法使用，为自己的行为负责"}),J={name:{rules:[{required:!0,errorMessage:"请输入声音名称"}]}},W=r((()=>{switch(A.value){case u.INIT:return"点击开始录音";case u.RECORDING:return"正在录音中...";case u.END:return"点击播放";case u.PAUSE:return"点击暂停"}}));function X(e){const a=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}function Y(){O(),A.value=u.RECORDING}function z(){T(),A.value=u.END,console.log("录音时长",G.value),G.value<6?(E("录音时长至少6秒"),H()):G.value>14?(E("录音时长最多14秒"),H()):B.value.duration=G.value}function H(){V(),A.value=u.INIT,B.value.duration=0}function K(){F(),A.value=u.PAUSE}function Q(){q(),A.value=u.END}const Z=n((async()=>{const e=await j.value.validate();console.log("表单校验通过",e);d({type:"file",data:{file:$.value},success:e=>{console.log("上传录音成功",e),B.value.file_id=e.id,s((()=>{ee()}))},fail:e=>{console.log("上传录音失败",e)}}).onProgressUpdate((e=>{console.log("上传进度：",`${e.progress}%`)}))}),800),ee=async()=>{await S(B.value),console.log("创建声音 请求成功"),x({url:`/bundle/pages/profile/index?type=${_.MySound}`})};return i((()=>{s((()=>{D.value.open()}))})),(e,a)=>{const l=c(f("uni-easyinput"),b),t=c(f("uni-forms-item"),y),o=c(f("uni-forms"),R),r=P,n=p("layout-default-uni");return g(),m(n,null,{default:v((()=>[h(r,{"px-3":"","py-2":"",position:"relative"},{default:v((()=>[h(o,{ref_key:"formRef",ref:j,"model-value":B.value,rules:J},{default:v((()=>[h(t,{label:"",name:"name"},{default:v((()=>[h(l,{modelValue:B.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value.name=e),placeholder:"输入声音名称"},null,8,["modelValue"])])),_:1})])),_:1},8,["model-value"]),h(r,{text:"sm foreground-muted","mt-4.5":"","bg-background-muted":"","px-2.5":"","py-4.5":"",class:"rounded-[var(--ui-radius)]"},{default:v((()=>[h(r,{start:""},{default:v((()=>[h(r,{"i-tabler:bulb":"",text:"sm foreground-muted"}),h(r,{text:"sm foreground-muted"},{default:v((()=>[k(" 提示: ")])),_:1})])),_:1}),h(r,null,{default:v((()=>[k(" 录音时请严格按照以下内容进行朗读，否则可能导致克隆失败或合成效果不好 ")])),_:1})])),_:1}),h(r,{text:"sm foreground-muted","mt-4.5":"","bg-primary":"","px-2.5":"","py-4.5":"",class:"rounded-[var(--ui-radius)]"},{default:v((()=>[h(r,{start:""},{default:v((()=>[h(r,{"i-tabler:microphone":"",text:"sm foreground-muted"}),h(r,{text:"sm foreground-muted"},{default:v((()=>[k(" 朗读内容: ")])),_:1})])),_:1}),h(r,null,{default:v((()=>[k(" 我的声音将用于平台克隆，并合法使用，为自己的行为负责")])),_:1})])),_:1}),h(r,{position:"fixed bottom-0 left-0","w-full":"",center:"","flex-col":"",class:"recording-handle"},{default:v((()=>[h(r,{text:"52rpx foreground-muted","mb-5.5":"","font-700":""},{default:v((()=>[k(w(X(I(G))),1)])),_:1}),A.value===I(u).INIT?(g(),m(r,{key:0,"h-148rpx":"","w-148rpx":"",center:"","rounded-full":"",class:"recording-btn",onClick:Y},{default:v((()=>[h(r,{"i-tabler:microphone-filled":"",text:"7.5 foreground-muted"})])),_:1})):N("",!0),A.value===I(u).RECORDING?(g(),m(r,{key:1,"h-148rpx":"","w-148rpx":"",center:"","rounded-full":"",border:"6 solid foreground-placeholder",onClick:z},{default:v((()=>[h(r,{"h-5":"","w-5":"","rounded-full":"","bg-primary":""})])),_:1})):N("",!0),A.value===I(u).END||A.value===I(u).PAUSE?(g(),m(r,{key:2,"w-full":"",between:"","px-108rpx":""},{default:v((()=>[h(r,{"h-112rpx":"","w-112rpx":"",center:"","rounded-full":"","bg-background-muted":""},{default:v((()=>[h(r,{"i-icon-park-outline:return":"",text:"5 foreground-muted",onClick:H})])),_:1}),h(r,{"h-148rpx":"","w-148rpx":"",center:"","rounded-full":"",class:"recording-btn"},{default:v((()=>[A.value===I(u).END?(g(),m(r,{key:0,"i-tabler:player-play-filled":"",text:"7.5 foreground-muted",onClick:K})):N("",!0),A.value===I(u).PAUSE?(g(),m(r,{key:1,"i-tabler:player-pause-filled":"",text:"7.5 foreground-muted",onClick:Q})):N("",!0)])),_:1}),h(r,{"h-112rpx":"","w-112rpx":"",center:"","rounded-full":"","bg-success":"",onClick:I(Z)},{default:v((()=>[h(r,{"i-tabler:check":"",text:"5 foreground-muted"})])),_:1},8,["onClick"])])),_:1})):N("",!0),h(r,{"mt-3":"",text:"sm foreground-muted"},{default:v((()=>[k(w(W.value),1)])),_:1})])),_:1}),h(U,{ref_key:"soundPopRef",ref:D},null,512)])),_:1})])),_:1})}}}),[["__scopeId","data-v-2b4f4a4b"]]);export{j as default};
