import{d as e,r as s,aI as a,f as t,a5 as l,k as r,G as o,J as u,l as i,o as n,c as p,w as c,a as d,n as m,p as f,F as g,q as _,V as v,R as x,ai as y,aj as h,v as j,i as k,b,t as w,aE as S,e as z,_ as C}from"./index-CTSv8bdf.js";import{_ as P}from"./ActionSheet.DxV314ss.js";import{_ as E}from"./EmptyStatus.vue_vue_type_script_setup_true_lang.BbsBdioH.js";import{_ as U}from"./ProductCard.pVvRNm7o.js";import{_ as V}from"./z-paging.DcYRLe5r.js";import{_ as F}from"./icon-sound.D7rZqbzE.js";import{_ as A}from"./icon-setting.BVTtbP7i.js";import{a as H,e as I}from"./avatar.D4ZfpDUd.js";import{i as J}from"./check.NUthcyNX.js";import{u as N,i as R}from"./usePollingTask.4RHfPE49.js";import"./index.BEstvkTC.js";const $=C(e({__name:"ProductList",props:{type:{}},setup(e){const C=e,$=s(),q=s(),D=s(),G=s(),K=a(null),L=s([]);let Q;const T=async(e,s)=>{try{const{lists:a}=await H({page_no:e,page_size:s,status:C.type});K.value.complete(a);const t=L.value.filter((e=>J(e.status))).length;Q&&Q(),t&&B(e*s)}catch(a){console.log("报错=>",a),K.value.complete(!1)}},B=async e=>{console.log("开始轮询");const{start:s,clear:a}=N((async s=>{const{lists:a}=await H({page_no:1,page_size:e,status:C.type});a.forEach(((e,s)=>{J(L.value[s].status)&&!R(e.status,L.value[s].status)&&(L.value[s]=e)}));0===a.filter((e=>J(e.status))).length&&s()}));Q=a,s()},M=async()=>{await I({id:q.value}),v("删除成功"),K.value.refresh()},O=()=>{const e=x({type:"video",fileUrl:D.value,success:e=>{console.log("保存成功",e)},fail:e=>{console.log("保存失败",e)}});null==e||e.onProgressUpdate((e=>{y({title:`下载进度：${e.progress}%`,mask:!0}),console.log("下载进度：",`${e.progress}%`),100===e.progress&&h()}))};const W=()=>{j({url:"/pages/digital_people/index"})};return t((()=>{l((()=>{var e;null==(e=K.value)||e.refresh()}))})),r((()=>{Q&&Q()})),(e,s)=>{const a=k,t=z,l=U,r=E,v=o(u("z-paging"),V),x=P,y=i("layout-default-uni");return n(),p(y,null,{default:c((()=>[d(a,{class:"list-height"},{default:c((()=>[d(v,{ref_key:"paging",ref:K,modelValue:L.value,"onUpdate:modelValue":s[0]||(s[0]=e=>L.value=e),fixed:!1,height:"100%",onQuery:T},{empty:c((()=>[d(a,{"h-full":"","w-full":""},{default:c((()=>[d(r,{"button-text":"创建数字人",onHandle:W})])),_:1})])),default:c((()=>[d(a,{class:"grid grid-cols-2 gap-22rpx px-3"},{default:c((()=>[(n(!0),m(g,null,f(L.value,(e=>(n(),p(l,{key:e.id,images:e.cover,time:e.duration,url:e.resultFile,status:e.status,"fail-reason":e.fail_reason},{content:c((()=>[d(a,{class:"line-clamp-1 mb-1 px-[28rpx]",text:"sm foreground"},{default:c((()=>[b(w(e.title),1)])),_:2},1024),d(a,{class:"flex items-center justify-between px-[16rpx]"},{default:c((()=>[d(a,{class:"mr-2 flex items-center rounded-[28rpx] bg-background-muted py-[8rpx] pl-[8rpx] pr-[16rpx]"},{default:c((()=>[d(t,{src:F,class:"h-[40rpx] w-[40rpx] flex-none"}),d(a,{text:"xs foreground-muted","line-clamp-1":"","ml-1":""},{default:c((()=>[b(w(null==e?void 0:e.voice_name),1)])),_:2},1024)])),_:2},1024),d(a,{class:"flex items-center justify-center rounded-[28rpx] bg-background-muted","min-h-56rpx":"","min-w-56rpx":"",onClick:s=>{return a=e.id,t=e.resultFile,l=e.status,q.value=a,D.value=t,G.value=l,void $.value.open();var a,t,l}},{default:c((()=>[d(t,{src:A,class:"h-[40rpx] w-[40rpx]"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["images","time","url","status","fail-reason"])))),128))])),_:1})])),_:1},8,["modelValue"]),d(x,{ref_key:"actionSheetRef",ref:$,actions:[{title:"下载",type:"primary",show:Number(G.value)===Number(_(S).SUCCESS),click:O},{title:"删除",type:"danger",click:M}]},null,8,["actions"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-0c160dba"]]);export{$ as default};
