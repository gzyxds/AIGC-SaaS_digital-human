import{W as B,X as P,R}from"./element-plus-CW14IAqd.js";import{a as V,k as u,R as k,f as p}from"./index-DkCvA8ar.js";import{d as A,G as F,r as f,b,o as n,c as m,f as y,g as C,m as j,Y as N,a as g,F as D,j as _,t as I,k as q}from"./@vue-CGao7vbS.js";import{_ as G}from"./@liripeng-tRfXSOOZ.js";const O=A({components:{},props:{type:{type:String,default:"image"},multiple:{type:Boolean,default:!0},limit:{type:Number,default:10},data:{type:Object,default:()=>({})},showProgress:{type:Boolean,default:!1}},emits:["change","error","success","allSuccess"],setup(e,{emit:a}){const h=V(),i=F(),v=f(`${u.baseUrl}${u.urlPrefix}/upload/${e.type}`),E=b(()=>({token:h.token,version:u.version})),l=f(!1),o=f([]),d=()=>{l.value=!0};let s=0;const c=(t,r)=>{s++,s==o.value.length&&(s=0,o.value=[],a("allSuccess")),a("change",r),t.code==k.SUCCESS&&a("success",t),t.code==k.FAIL&&t.msg&&p.msgError(t.msg)},$=(t,r)=>{var S;s++,s==o.value.length&&(s=0,o.value=[],a("allSuccess")),p.msgError(`${r.name}文件上传失败`),(S=i.value)==null||S.abort(r),l.value=!1,a("change",r),a("error",r)},L=()=>{p.msgError(`超出上传上限${e.limit}，请重新上传`)},w=()=>{o.value=[],l.value=!1},U=b(()=>{switch(e.type){case"image":return".jpg,.png,.gif,.jpeg,.ico";case"video":return".wmv,.avi,.mpg,.mpeg,.3gp,.mov,.mp4,.flv,.rmvb,.mkv";default:return"*"}});return{uploadRefs:i,action:v,headers:E,visible:l,fileList:o,getAccept:U,handleProgress:d,handleSuccess:c,handleError:$,handleExceed:L,handleClose:w}}}),W={class:"upload"},X={class:"file-list p-4"},Y={class:"flex-1"};function z(e,a,h,i,v,E){const l=B,o=P,d=R;return n(),m("div",W,[y(l,{"file-list":e.fileList,"onUpdate:fileList":a[0]||(a[0]=s=>e.fileList=s),ref:"uploadRefs",action:e.action,multiple:e.multiple,limit:e.limit,"show-file-list":!1,headers:e.headers,data:e.data,"on-progress":e.handleProgress,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,"on-error":e.handleError,accept:e.getAccept},{default:C(()=>[j(e.$slots,"default")]),_:3},8,["file-list","action","multiple","limit","headers","data","on-progress","on-success","on-exceed","on-error","accept"]),e.showProgress&&e.fileList.length?(n(),N(d,{key:0,modelValue:e.visible,"onUpdate:modelValue":a[1]||(a[1]=s=>e.visible=s),title:"上传进度","close-on-click-modal":!1,width:"500px",modal:!1,onClose:e.handleClose},{default:C(()=>[g("div",X,[(n(!0),m(D,null,_(e.fileList,(s,c)=>(n(),m("div",{key:c,class:"mb-5"},[g("div",null,I(s.name),1),g("div",Y,[y(o,{percentage:parseInt(s.percentage)},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue","onClose"])):q("",!0)])}const Q=G(O,[["render",z]]);export{Q as U};
