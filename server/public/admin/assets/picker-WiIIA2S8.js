import{P as I}from"./index-Da-RjlL5.js";import{s as T}from"./element-plus-CW14IAqd.js";import{F as N,_ as B,a as W}from"./index-Di-Xkxjj.js";import{u as M,b as j}from"./index-DkCvA8ar.js";import{_ as q}from"./index-BIwWuBYp.js";import{D as G}from"./vuedraggable-CNVEpOcE.js";import{d as H,r as s,a1 as J,b as S,y as K,w as O,W as $,ah as _,o as Q,c as X,f as n,ac as Y,g as p,a as i,e as P,l as k,_ as Z,i as x,m as ee,n as le,v as te}from"./@vue-CGao7vbS.js";import{e as ae}from"./@vueuse-CuqWKaqQ.js";import{_ as oe}from"./@liripeng-tRfXSOOZ.js";const ie=H({components:{Popup:I,Draggable:G,FileItem:N,Material:B,Preview:W},props:{modelValue:{type:[String,Array],default:()=>[]},type:{type:String,default:"image"},size:{type:String,default:"100px"},width:{type:String,default:""},height:{type:String,default:""},fileSize:{type:String,default:"100px"},limit:{type:Number,default:1},disabled:{type:Boolean,default:!1},hiddenUpload:{type:Boolean,default:!1},uploadClass:{type:String,default:""},excludeDomain:{type:Boolean,default:!1}},emits:["change","update:modelValue"],setup(e,{emit:t}){const g=s(),c=s(),w=s(""),y=s(!1),a=s([]),m=s([]),r=s(!0),f=s(-1),{disabled:C,limit:u,modelValue:b}=J(e),{getImageUrl:U}=M(),o=S(()=>{switch(e.type){case"image":return"图片";case"video":return"视频";default:return""}}),v=l=>!l.startsWith("http://")||!l.startsWith("https://"),h=S(()=>e.limit-a.value.length>0),D=S(()=>r.value?u.value==-1?null:u.value-a.value.length:1),A=ae(()=>{const l=m.value.map(d=>e.excludeDomain?d.uri:d.url);r.value?a.value=[...a.value,...l]:a.value.splice(f.value,1,l.shift()),z()},1e3,!1),E=l=>{var d;C.value||(l>=0?(r.value=!1,f.value=l):r.value=!0,(d=g.value)==null||d.open())},F=l=>{m.value=l},z=()=>{const l=u.value!=1?a.value:a.value[0]||"";t("update:modelValue",l),t("change",l),V()},L=l=>{a.value.splice(l,1),z()},R=l=>{w.value=l,y.value=!0},V=()=>{K(()=>{var l;e.hiddenUpload&&(a.value=[]),(l=c.value)==null||l.clearSelect()})};return O(b,l=>{a.value=Array.isArray(l)?l:l==""?[]:[l]},{immediate:!0}),$("limit",e.limit),$("hiddenUpload",e.hiddenUpload),{resolveUrl:v,popupRef:g,materialRef:c,fileList:a,tipsText:o,handleConfirm:A,meterialLimit:D,showUpload:h,showPopup:E,selectChange:F,deleteImg:L,previewUrl:w,showPreview:y,handlePreview:R,handleClose:V,getImageUrl:U}}}),se={class:"material-select"},ne=["onClick"],re={class:"operation-btns text-xs text-center"},ue=["onClick"],de={class:"material-wrap"};function pe(e,t,g,c,w,y){const a=_("file-item"),m=q,r=_("draggable"),f=j,C=B,u=T,b=I,U=_("preview");return Q(),X("div",se,[n(b,{ref:"popupRef",width:"1050px","custom-class":"body-padding",title:`选择${e.tipsText}`,onConfirm:e.handleConfirm,onClose:e.handleClose},Y({default:p(()=>[n(u,null,{default:p(()=>[i("div",de,[n(C,{ref:"materialRef",type:e.type,"file-size":e.fileSize,limit:e.meterialLimit,onChange:e.selectChange},null,8,["type","file-size","limit","onChange"])])]),_:1})]),_:2},[e.hiddenUpload?void 0:{name:"trigger",fn:p(()=>[i("div",{class:"material-select__trigger clearfix",onClick:t[2]||(t[2]=P(()=>{},["stop"]))},[n(r,{class:"draggable",modelValue:e.fileList,"onUpdate:modelValue":t[0]||(t[0]=o=>e.fileList=o),animation:"300","item-key":"id"},{item:p(({element:o,index:v})=>[i("div",{class:k(["material-preview",{"is-disabled":e.disabled,"is-one":e.limit==1}]),onClick:h=>e.showPopup(v)},[n(m,{onClose:h=>e.deleteImg(v)},{default:p(()=>[n(a,{uri:e.excludeDomain||e.resolveUrl(o)?e.getImageUrl(o):o,"file-size":e.size,width:e.width,height:e.height,type:e.type},null,8,["uri","file-size","width","height","type"])]),_:2},1032,["onClose"]),i("div",re,[t[4]||(t[4]=i("span",null,"修改",-1)),t[5]||(t[5]=Z(" | ")),i("span",{onClick:P(h=>e.handlePreview(o),["stop"])},"查看",8,ue)])],10,ne)]),_:1},8,["modelValue"]),x(i("div",{class:k(["material-upload",{"is-disabled":e.disabled,"is-one":e.limit==1,[e.uploadClass]:!0}]),onClick:t[1]||(t[1]=o=>e.showPopup(-1))},[ee(e.$slots,"upload",{},()=>[i("div",{class:"upload-btn",style:le({width:e.width||e.size,height:e.height||e.size})},[n(f,{size:25,name:"el-icon-Plus"}),t[6]||(t[6]=i("span",null,"添加",-1))],4)],!0)],2),[[te,e.showUpload]])])]),key:"0"}]),1032,["title","onConfirm","onClose"]),n(U,{modelValue:e.showPreview,"onUpdate:modelValue":t[3]||(t[3]=o=>e.showPreview=o),url:e.previewUrl,type:e.type},null,8,["modelValue","url","type"])])}const be=oe(ie,[["render",pe],["__scopeId","data-v-14d25a28"]]);export{be as _};
