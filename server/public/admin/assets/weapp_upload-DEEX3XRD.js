import{P as z,I,B as D,C as M,h as N,D as S}from"./element-plus-CW14IAqd.js";import{u as L,c as g,f as v,t as R,b as U}from"./index-DkCvA8ar.js";import{u as A}from"./weapp-DqYIKHkT.js";import{u as j}from"./useLockFn-CLmIqRri.js";import{d as w,a0 as b,G,x as K,o as m,c as d,f as s,g as l,a,z as e,_ as O,Y as P,k as c,l as T,t as k}from"./@vue-CGao7vbS.js";import"./lodash-es-R-kYiKr_.js";import"./async-validator-DKvM95Vc.js";import"./@element-plus-b4noGO9g.js";import"./dayjs-CMfar2R3.js";import"./balanced-match-mNcR6oh4.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@popperjs-D9SI2xQl.js";import"./nprogress-Cgf5DU8x.js";import"./vue-router-akAgejHM.js";import"./pinia-C8SLiYOc.js";import"./axios-C-n2IhIP.js";import"./lodash-BtPWuHkK.js";import"./@vueuse-CuqWKaqQ.js";import"./css-color-function-rJvg8h-6.js";import"./color-B0v57BL7.js";import"./clone-CuIhj1wH.js";import"./color-convert-BGgJB5UM.js";import"./color-name-BQ5IbGbl.js";import"./color-string-BhgG7-8u.js";import"./ms-CzQ2E3wO.js";import"./@liripeng-tRfXSOOZ.js";import"./vue-clipboard3-8CNoFg4V.js";import"./clipboard-Dch_ozqB.js";import"./echarts-BR_QmBtV.js";import"./tslib-BDyQ-Jie.js";import"./zrender-B-CeXLwU.js";import"./highlight.js-D5uP1KGk.js";import"./@highlightjs-l-30Ih9A.js";const Y={class:"w-80"},$={class:"w-80"},q={class:"bg-page w-80 p-[20px] rounded"},H={key:0,class:"flex items-center"},J={key:1,class:"flex items-center"},Q={class:"text-tx-secondary text-sm"},W=w({name:"weappUpload"}),So=w({...W,setup(X){const u="mnp_upload_info",_=L(),n=b({upload_desc:""}),C=G(),o=b({status:-1,msg:"",time:""}),{lockFn:V,isLock:E}=j(async()=>{v.loading("正在上传中...");try{const{code:r}=await A(n);o.status=r,r===1?o.msg="请前往小程序后台提交审核！":o.msg="请重新上传"}catch(r){o.status=0,o.msg="请重新上传",console.error(r)}finally{o.time=R(Date.now(),"yyyy-mm-dd hh:MM:ss"),g.set(u,o,24*3600),v.closeLoading()}});return K(()=>{const r=g.get(u);r&&Object.assign(o,r)}),(r,t)=>{const B=z,f=I,x=D,i=M,F=N,y=U,h=S;return m(),d("div",null,[s(f,{class:"!border-none",shadow:"never"},{default:l(()=>[s(B,{class:"text-xxl",type:"error",closable:!1,"show-icon":""},{title:l(()=>t[2]||(t[2]=[a("div",{class:"py-[3px]"},"温馨提示：",-1),a("div",{class:"py-[3px]"}," 1.首次使用小程序一键上传，先安装好node环境，然后在终端下使用cd命令进到项目下的server/extend/miniprogram-ci目录，运行命令 npm install miniprogram-ci --save 建议使用node最新版本。 ",-1),a("div",{class:"py-[3px]"}," 2.小程序上传前，请先到本系统的`小程序配置`设置小程序代码上传密钥，如已配置，请忽略； ",-1),a("div",{class:"py-[3px]"},"3.小程序上传成功后，要前往小程序后台提交审核哦；",-1)])),_:1})]),_:1}),s(h,{ref_key:"formRef",ref:C,model:e(n),"label-width":"120px"},{default:l(()=>[s(f,{class:"!border-none mt-4",shadow:"never"},{default:l(()=>[t[6]||(t[6]=a("div",{class:"font-medium mb-7"},"小程序一键上传",-1)),s(i,{label:"版本号",prop:"name"},{default:l(()=>[a("div",Y,[s(x,{disabled:!0,modelValue:e(_).config.version,"onUpdate:modelValue":t[0]||(t[0]=p=>e(_).config.version=p)},null,8,["modelValue"])])]),_:1}),s(i,{label:"项目备注",prop:"original_id"},{default:l(()=>[a("div",$,[s(x,{type:"textarea",rows:4,resize:"none",modelValue:e(n).upload_desc,"onUpdate:modelValue":t[1]||(t[1]=p=>e(n).upload_desc=p),placeholder:"请输入项目备注"},null,8,["modelValue"])])]),_:1}),s(i,null,{default:l(()=>[s(F,{type:"primary",loading:e(E),onClick:e(V)},{default:l(()=>t[3]||(t[3]=[O("上传小程序")])),_:1},8,["loading","onClick"])]),_:1}),e(o).status!==-1?(m(),P(i,{key:0},{default:l(()=>[a("div",q,[e(o).status==1?(m(),d("div",H,[s(y,{name:"el-icon-SuccessFilled",class:"text-success",size:18}),t[4]||(t[4]=a("span",{class:"font-bold ml-[10px]"}," 上传成功 ",-1))])):c("",!0),e(o).status==0?(m(),d("div",J,[s(y,{name:"el-icon-CircleCloseFilled",class:"text-error",size:18}),t[5]||(t[5]=a("span",{class:"font-bold ml-[10px]"}," 上传失败 ",-1))])):c("",!0),a("span",{class:T(["msg break-words",{"text-error":e(o).status==0,"text-tx-secondary":e(o).status==1}])},k(e(o).msg),3),a("div",Q,k(e(o).time),1)])]),_:1})):c("",!0)]),_:1})]),_:1},8,["model"])])}}});export{So as default};
