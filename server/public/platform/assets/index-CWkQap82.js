import{Q as j,G as A,H as M,R as q,g as G,K as H,P as K,O as Q}from"./element-plus-CSiqOtzA.js";import{_ as Z}from"./index.vue_vue_type_script_setup_true_lang-ggB8NA6X.js";import{r as D,u as I}from"./index-B_OJBac2.js";import{u as h}from"./useLockFn-BhPLnZje.js";import{u as J}from"./usePaging-DFi_nJOG.js";import{d as W,Z as X,f as Y,an as ee,o as n,c as a,V as r,M as o,a as i,S as d,O as C,u as s,L as y,T as _,R as V,U as x,aa as w,i as te}from"./@vue-TMcuEboY.js";import"./lodash-es-R-kYiKr_.js";import"./async-validator-DKvM95Vc.js";import"./@element-plus-C2WBhajb.js";import"./dayjs-CMfar2R3.js";import"./balanced-match-mNcR6oh4.js";import"./@ctrl-r5W6hzzQ.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@popperjs-D9SI2xQl.js";import"./nprogress-Cgf5DU8x.js";import"./vue-router-CZY6S6gL.js";import"./pinia-ebUeA1L2.js";import"./axios-C-n2IhIP.js";import"./lodash-BtPWuHkK.js";import"./@vueuse-DE_336rM.js";import"./css-color-function-rJvg8h-6.js";import"./color-B0v57BL7.js";import"./clone-CuIhj1wH.js";import"./color-convert-BGgJB5UM.js";import"./color-name-BQ5IbGbl.js";import"./color-string-BhgG7-8u.js";import"./ms-CzQ2E3wO.js";import"./vue-clipboard3-8CNoFg4V.js";import"./clipboard-Dch_ozqB.js";import"./echarts-BR_QmBtV.js";import"./tslib-BDyQ-Jie.js";import"./zrender-B-CeXLwU.js";import"./highlight.js-D5uP1KGk.js";import"./@highlightjs-KJi31KWJ.js";function le(f){return D.get({url:"/upgrade.upgrade/lists",params:f})}function ie(f){return D.post({url:"/upgrade.upgrade/downloadPkg",params:f})}function oe(f){return D.post({url:"/upgrade.upgrade/upgrade",params:f,timeout:120*1e3})}const se={class:"flex items-center"},ne={class:"mr-2"},re={class:""},ae={class:"operation flex flex-wrap"},de={class:"flex mt-4 justify-end"},pe={class:"flex flex-col justify-between items-center"},ue={class:"flex flex-col pb-8"},me={class:"mt-2.5"},fe={class:"mt-2.5"},ce={key:0,style:{"text-align":"center"}},_e={key:1,style:{"text-align":"center"}},ve={key:0,class:"mt-2.5"},ge={class:"pt-10",style:{height:"200px","text-align":"center"}},be={"element-loading-text":"系统更新中，更新完毕后会自行刷新页面 切勿关闭窗口或刷新页面"},Ye=W({__name:"index",setup(f){const L=I(),t=X({id:"",outerVisible:!1,loading:!1,isSecondaryDev:!1,threeVisible:!1,innerVisible:!1}),{pager:c,getLists:S}=J({fetchFun:le});h(async(g,e)=>{const b=await ie({id:g,update_type:e});e==6?window.open(b.line,"_blank"):window.location.href=b.line});const $=g=>{t.outerVisible=!0,t.id=g},B=()=>{t.innerVisible=!1,t.threeVisible=!0,N()},T=()=>{t.outerVisible=!1,t.isSecondaryDev=!1,t.innerVisible=!0},F=()=>{t.outerVisible=!1,t.isSecondaryDev=!0,t.innerVisible=!0},{lockFn:N}=h(async()=>{try{t.loading=!0,await oe({id:t.id,update_type:1}),location.reload()}finally{t.threeVisible=!1,t.innerVisible=!1,t.outerVisible=!1}});return Y(()=>{S()}),(g,e)=>{const b=j,E=A,v=M,P=q,u=G,z=H,O=Z,k=K,R=ee("perms"),U=Q;return n(),a("div",null,[r(E,{class:"!border-none",shadow:"never"},{default:o(()=>[r(b,{class:"text-xxl",type:"warning",closable:!1,"show-icon":""},{title:o(()=>e[7]||(e[7]=[i("div",{class:"py-[3px]"},"温馨提示：",-1),i("div",{class:"py-[3px]"},[d(" 1.版本更新需要逐个版本更新， "),i("span",{class:"text-[#f56c6c]"}," 更新前请备份好系统和数据库，更新成功后需要强制刷新站点； ")],-1),i("div",{class:"py-[3px]"},"2.系统没有做二次开发，可以直接选择在线更新功能；",-1),i("div",{class:"py-[3px]"}," 3.系统已做二次开发，进行了功能修改，请谨慎选择在线更新功能，推荐以更新包的形式手动更新； ",-1)])),_:1})]),_:1}),C((n(),y(E,{class:"!border-none mt-4",shadow:"never"},{default:o(()=>[i("div",null,[r(z,{data:s(c).lists,size:"large",border:""},{default:o(()=>[r(v,{prop:"publish_time",label:"发布日期","min-width":"180px"}),r(v,{label:"版本号","min-width":"160px"},{default:o(l=>[i("div",se,[i("div",ne,_(l.row.version_no),1),l.$index==0&&s(c).page==1?(n(),y(P,{key:0,size:"small",type:"primary"},{default:o(()=>e[8]||(e[8]=[d(" 最新 ")])),_:1})):V("",!0)]),i("div",re,_(l.row.version_str),1)]),_:1}),r(v,{prop:"",label:"版本内容","min-width":"220px"},{default:o(l=>[(n(!0),a(x,null,w(l.row.add,(p,m)=>(n(),a("div",{class:"",key:m},_(p),1))),128)),(n(!0),a(x,null,w(l.row.optimize,(p,m)=>(n(),a("div",{class:"",key:m},_(p),1))),128)),(n(!0),a(x,null,w(l.row.repair,(p,m)=>(n(),a("div",{class:"",key:m},_(p),1))),128))]),_:1}),r(v,{prop:"notice",label:"注意事项","min-width":"220px"},{default:o(l=>[(n(!0),a(x,null,w(l.row.notice,(p,m)=>(n(),a("div",{class:"text-[red]",key:m},_(p),1))),128))]),_:1}),s(L).config.agent?V("",!0):(n(),y(v,{key:0,label:"操作",width:"160px",fixed:"right"},{default:o(l=>[i("div",ae,[C((n(),a("div",null,[l.row.able_update==1?(n(),y(u,{key:0,type:"primary",link:"",onClick:p=>$(l.row.id)},{default:o(()=>e[9]||(e[9]=[d(" 一键更新 ")])),_:2},1032,["onClick"])):V("",!0)])),[[R,["upgrade.upgrade/upgrade"]]])])]),_:1}))]),_:1},8,["data"])]),i("div",de,[r(O,{modelValue:s(c),"onUpdate:modelValue":e[0]||(e[0]=l=>te(c)?c.value=l:null),onChange:s(S)},null,8,["modelValue","onChange"])])]),_:1})),[[U,s(c).loading]]),r(k,{modelValue:s(t).outerVisible,"onUpdate:modelValue":e[2]||(e[2]=l=>s(t).outerVisible=l),width:"400px",title:"系统是否进行二次开发",center:""},{default:o(()=>[i("div",pe,[i("div",ue,[i("div",null,[r(u,{class:"w-full",type:"primary",onClick:T},{default:o(()=>e[10]||(e[10]=[d(" 未做二次开发，直接更新 ")])),_:1})]),i("div",me,[r(u,{class:"w-full",onClick:F},{default:o(()=>e[11]||(e[11]=[d("已做二次开发")])),_:1})]),i("div",fe,[r(u,{class:"w-full",onClick:e[1]||(e[1]=l=>s(t).outerVisible=!1)},{default:o(()=>e[12]||(e[12]=[d(" 取消更新 ")])),_:1})])])])]),_:1},8,["modelValue"]),r(k,{width:"400px",modelValue:s(t).innerVisible,"onUpdate:modelValue":e[5]||(e[5]=l=>s(t).innerVisible=l),"append-to-body":"",center:""},{footer:o(()=>[i("div",null,[r(u,{type:"primary",onClick:B},{default:o(()=>e[14]||(e[14]=[d(" 确定更新 ")])),_:1}),r(u,{onClick:e[3]||(e[3]=l=>s(t).innerVisible=!1)},{default:o(()=>e[15]||(e[15]=[d(" 取消更新 ")])),_:1})]),s(t).isSecondaryDev?(n(),a("div",ve,[r(u,{onClick:e[4]||(e[4]=l=>s(t).innerVisible=!1)},{default:o(()=>e[16]||(e[16]=[d(" 下载更新包，手动更新 ")])),_:1})])):V("",!0)]),default:o(()=>[i("div",null,[s(t).isSecondaryDev==!1?(n(),a("div",ce," 一键更新导致的系统问题，欢迎前往社区反馈，请做好系统备份！ ")):(n(),a("div",_e,e[13]||(e[13]=[i("div",null,"二次开发后请谨慎使用一键更新功能！",-1),i("div",null,"二次开发后一键更新导致的系统问题，官方无法处理，请做好系统备份！",-1)])))])]),_:1},8,["modelValue"]),r(k,{width:"300px",modelValue:s(t).threeVisible,"onUpdate:modelValue":e[6]||(e[6]=l=>s(t).threeVisible=l),"append-to-body":"",title:"更新中",center:"","close-on-click-modal":!1,"close-on-press-escape":!1},{default:o(()=>[i("div",ge,[C(i("div",be,null,512),[[U,s(t).loading]])])]),_:1},8,["modelValue"])])}}});export{Ye as default};
